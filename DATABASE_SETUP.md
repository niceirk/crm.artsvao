# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–î–∞—Ç–∞:** 2025-11-13
**PostgreSQL –≤–µ—Ä—Å–∏—è:** 18.0
**–ü—Ä–æ–≤–∞–π–¥–µ—Ä:** Timeweb Cloud

---

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ —à–∞–≥–∏

### 1. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL 18.0 –Ω–∞ Timeweb Cloud:**

- **Host:** ad58d335a4d560f18508292d.twc1.net
- **Port:** 5432
- **Database:** default_db
- **User:** gen_user
- **Password:** 5_7qsroh-hDw@_

### 2. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–∫–∞—á–∞–Ω –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ `.cloud-certs/root.crt`

**–ò—Å—Ç–æ—á–Ω–∏–∫:** https://st.timeweb.com/cloud-static/ca.crt

### 3. –§–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### `.env` —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω

–°–æ–¥–µ—Ä–∂–∏—Ç:
- `DATABASE_URL` - –æ—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å SSL
- `DIRECT_DATABASE_URL` - –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π Prisma
- –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ë–î –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è JWT, API URL, YooKassa

#### `.env.example` —Å–æ–∑–¥–∞–Ω

–®–∞–±–ª–æ–Ω –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (–±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö credentials).

#### `.gitignore` —Å–æ–∑–¥–∞–Ω

–°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è:
- `node_modules/`
- `.env*`
- `.cloud-certs/`
- IDE —Ñ–∞–π–ª—ã
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

‚úÖ **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!**

```
üìä –í–µ—Ä—Å–∏—è PostgreSQL: 18.0
üóÑÔ∏è  –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: default_db
üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: gen_user
üîê –ü—Ä–∞–≤–∞ CREATE: –î–∞ ‚úÖ
```

### 5. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è PostgreSQL

–í—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:

| –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------------|--------|------------|
| `uuid-ossp` | 1.1 | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è UUID –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π |
| `pg_trgm` | 1.6 | –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Å —Ç—Ä–∏–≥—Ä–∞–º–º–∞–º–∏ |
| `btree_gin` | 1.3 | –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤ |
| `btree_gist` | 1.8 | –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤ |
| `unaccent` | 1.1 | –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ (—É–¥–∞–ª–µ–Ω–∏–µ –∞–∫—Ü–µ–Ω—Ç–æ–≤) |
| `plpgsql` | 1.0 | –ü—Ä–æ—Ü–µ–¥—É—Ä–Ω—ã–π —è–∑—ã–∫ SQL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |

---

## üìù –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `.env` - –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å credentials
- ‚úÖ `.env.example` - —à–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ `.gitignore` - –ø—Ä–∞–≤–∏–ª–∞ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏—è Git
- ‚úÖ `.cloud-certs/root.crt` - SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

### –°–∫—Ä–∏–ø—Ç—ã
- ‚úÖ `test-db-connection.js` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- ‚úÖ `scripts/sql/001_init_extensions.sql` - SQL —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
- ‚úÖ `scripts/install-extensions.js` - Node.js —Å–∫—Ä–∏–ø—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π

### –ü—Ä–æ–µ–∫—Ç
- ‚úÖ `package.json` - npm –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Å–∫—Ä–∏–ø—Ç—ã

---

## üöÄ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
```bash
npm run test:db
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π PostgreSQL
```bash
npm run db:install-extensions
```

### Prisma –∫–æ–º–∞–Ω–¥—ã (–ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è schema.prisma)
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Prisma Client
npm run prisma:generate

# –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
npm run prisma:migrate

# –û—Ç–∫—Ä—ã—Ç—å Prisma Studio (GUI –¥–ª—è –ë–î)
npm run prisma:studio

# –ó–∞–ø–æ–ª–Ω–∏—Ç—å –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
npm run prisma:seed
```

---

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –°–æ–∑–¥–∞—Ç—å Prisma —Å—Ö–µ–º—É

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `prisma/schema.prisma` –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ –ø–∞–ø–∫–µ `modules/`:

```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextIndex"]
}

// –ú–æ–¥–µ–ª–∏ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏...
```

**–ë–∞–∑–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –æ–ø–∏—Å–∞–Ω—ã –≤:**
- `modules/01_CRM_MODULE.md` - Client, BenefitCategory, ClientRelation
- `modules/02_SCHEDULE_MODULE.md` - Schedule, Rental, Event
- `modules/03_STUDIOS_MODULE.md` - Studio, Group, Attendance, IndividualLesson
- `modules/04_SUBSCRIPTIONS_MODULE.md` - Subscription, Invoice, Payment, Refund
- `modules/05_SALARY_MODULE.md` - Salary, SalaryPayment
- `modules/06_DIRECTORIES_MODULE.md` - Room, Teacher, User

### 2. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
npx prisma migrate dev --name init
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—É –≤ Prisma Studio

```bash
npx prisma studio
```

### 4. –°–æ–∑–¥–∞—Ç—å seed –¥–∞–Ω–Ω—ã–µ

–°–æ–∑–¥–∞–π—Ç–µ `prisma/seed.js` –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –ë–î –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å—Ç—É–¥–∏–π
- –¢–∏–ø—ã —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π
- –õ—å–≥–æ—Ç–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –¢–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- ‚úÖ `POSTGRESQL_COMPATIBILITY_ANALYSIS.md` - –∞–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å PostgreSQL 17/18
- ‚úÖ `CONTRADICTIONS_FIXED.md` - –≤—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- ‚úÖ `DATABASE_SETUP.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î)

### –ú–æ–¥—É–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞:
- `modules/01_CRM_MODULE.md`
- `modules/02_SCHEDULE_MODULE.md`
- `modules/03_STUDIOS_MODULE.md`
- `modules/04_SUBSCRIPTIONS_MODULE.md`
- `modules/05_SALARY_MODULE.md`
- `modules/06_DIRECTORIES_MODULE.md`
- `modules/07_REPORTS_MODULE.md`

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **`.env` —Ñ–∞–π–ª –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ Git!**
   - –£–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`
   - –•—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ

2. **SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç**
   - –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–∫–∞—á–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sslmode=require` –∏–ª–∏ `sslmode=verify-full`

3. **–ü–∞—Ä–æ–ª–∏**
   - –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
   - –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ credentials

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **–ò–Ω–¥–µ–∫—Å—ã**
   - –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –æ–ø–∏—Å–∞–Ω—ã –≤ –º–æ–¥—É–ª—è—Ö
   - –ë—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Prisma –º–∏–≥—Ä–∞—Ü–∏–∏

2. **Connection Pooling**
   - –î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PgBouncer
   - –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Prisma connection pool limits

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (> 1 —Å–µ–∫—É–Ω–¥—ã)
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `pg_stat_statements` –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üÜò –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –æ—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å credentials –≤ `.env`
2. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ –ë–î (ping)
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ firewall
4. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç

### –û—à–∏–±–∫–∞ SSL

–ï—Å–ª–∏ –æ—à–∏–±–∫–∏ —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–∫–∞—á–∞–Ω: `.cloud-certs/root.crt`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—É –≤ `DATABASE_URL`
3. –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sslmode=disable`

### –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "permission denied":
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `gen_user`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ CREATE –Ω–∞ –±–∞–∑–µ
3. –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ SUPERUSER (—É–∂–µ –µ—Å—Ç—å)

---

## üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ PostgreSQL 18.0 –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ SSL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `.env` —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω
- ‚úÖ `package.json` –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≥–æ—Ç–æ–≤—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –í—Å–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ PostgreSQL 18 —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

### –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥
‚û°Ô∏è **–°–æ–∑–¥–∞–Ω–∏–µ Prisma —Å—Ö–µ–º—ã** –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥—É–ª–µ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ!** üéâ
