# Модуль 7: Отчетность и аналитика

**Версия:** 1.0
**Дата:** 2025-11-13
**Статус:** В разработке

---

## Содержание

1. [Общее описание](#1-общее-описание)
2. [Финансовые отчеты](#2-финансовые-отчеты)
3. [Отчеты по посещаемости](#3-отчеты-по-посещаемости)
4. [Отчеты по загруженности](#4-отчеты-по-загруженности)
5. [Отчеты по эффективности](#5-отчеты-по-эффективности)
6. [Дашборд](#6-дашборд)
7. [API эндпоинты](#7-api-эндпоинты)

---

## 1. Общее описание

### 1.1. Назначение модуля

Модуль **Отчетность и аналитика** предоставляет комплексные отчеты и аналитику по всем аспектам деятельности культурного центра:
- Финансовые отчеты (выручка, расходы, прибыль)
- Отчеты по посещаемости
- Отчеты по загруженности помещений и групп
- Отчеты по эффективности сотрудников
- Интерактивный дашборд с ключевыми метриками

---

## 2. Финансовые отчеты

### 2.1. Отчет по выручке

**Период:** произвольный (от даты до даты)

**Показатели:**
- Общая выручка
- Выручка от абонементов студий (разбивка по студиям)
- Выручка от аренды помещений
- Выручка от индивидуальных занятий
- Выручка от разовых посещений

**Графики:**
- Динамика выручки по дням/неделям/месяцам
- Круговая диаграмма: структура выручки

**API:** `GET /api/reports/revenue`

**Query параметры:**
- `dateFrom`, `dateTo` (required)
- `groupBy` (optional): `day` | `week` | `month`

---

### 2.2. Отчет по расходам

**Показатели:**
- Заработная плата (преподаватели, менеджеры, администрация)
- Прочие расходы (возвраты, компенсации)

**API:** `GET /api/reports/expenses`

---

### 2.3. Отчет прибыли и убытков (P&L)

**Показатели:**
- Выручка
- Расходы
- Прибыль (выручка - расходы)
- Рентабельность (%)

**API:** `GET /api/reports/profit-loss`

---

## 3. Отчеты по посещаемости

### 3.1. Отчет по посещаемости групп

**Описание:** Статистика посещаемости по группам за период (уже описано в модуле Студий)

**API:** `GET /api/reports/studios/attendance`

**Показатели:**
- Запланировано занятий
- Фактически присутствовало
- Отсутствовало
- Процент посещаемости

---

### 3.2. Отчет по посещаемости клиента

**Описание:** История посещений конкретного клиента

**API:** `GET /api/reports/clients/:id/attendance`

**Показатели:**
- Всего занятий
- Посещено
- Пропущено (с разбивкой по причинам)
- Процент посещаемости

---

## 4. Отчеты по загруженности

### 4.1. Отчет по загруженности помещений

**Описание:** Статистика использования помещений

**API:** `GET /api/reports/rooms/occupancy`

**Показатели:**
- Всего часов в периоде
- Занято часов (занятия студий + аренда + мероприятия)
- Свободно часов
- Процент загруженности

**Графики:**
- Тепловая карта загруженности (по дням недели и времени суток)
- Сравнение загруженности помещений

---

### 4.2. Отчет по загруженности групп

**Описание:** Заполненность групп (уже описано в модуле Студий)

**API:** `GET /api/reports/groups/capacity`

**Показатели:**
- Макс. участников
- Активных участников
- Свободных мест
- В листе ожидания
- Процент заполненности

---

## 5. Отчеты по эффективности

### 5.1. Отчет по эффективности преподавателей

**API:** `GET /api/reports/teachers/performance`

**Показатели:**
- Количество групп
- Количество участников
- Средняя посещаемость групп
- Выручка от групп
- Заработная плата
- Соотношение выручка/ЗП

---

### 5.2. Отчет по эффективности менеджеров

**API:** `GET /api/reports/managers/performance`

**Показатели:**
- Количество оформленных абонементов
- Количество сделок аренды
- Выручка от аренды
- Заработная плата
- Конверсия (новые клиенты)

---

## 6. Дашборд

### 6.1. Главный дашборд

**Ключевые метрики (за текущий месяц):**

```
┌─────────────────────────────────────────────────────────────┐
│ Дашборд                             Период: Ноябрь 2024     │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐│
│ │ Выручка         │ │ Расходы (ЗП)    │ │ Прибыль         ││
│ │ 850 000 руб.    │ │ 420 000 руб.    │ │ 430 000 руб.    ││
│ │ +12% к прошлому │ │ +8% к прошлому  │ │ +15% к прошлому ││
│ └─────────────────┘ └─────────────────┘ └─────────────────┘│
│                                                               │
│ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐│
│ │ Активных        │ │ Новых клиентов  │ │ Средний чек     ││
│ │ абонементов     │ │ за месяц        │ │ абонемента      ││
│ │ 245             │ │ 38              │ │ 4 500 руб.      ││
│ └─────────────────┘ └─────────────────┘ └─────────────────┘│
│                                                               │
│ График выручки по дням:                                      │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │  (график)                                                │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                               │
│ Топ-5 студий по выручке:                                     │
│ 1. Танцы          - 250 000 руб.                             │
│ 2. Вокал          - 180 000 руб.                             │
│ 3. Йога           - 120 000 руб.                             │
│ 4. Английский     - 100 000 руб.                             │
│ 5. Рисование      - 90 000 руб.                              │
│                                                               │
│ Загруженность помещений:                                     │
│ Зал 1: ████████████░░░░░░░░ 65%                             │
│ Зал 2: ██████████████████░░ 85%                             │
│ Зал 3: ████████░░░░░░░░░░░░ 45%                             │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

**API:** `GET /api/dashboard`

---

## 7. API эндпоинты

### 7.1. Финансовые отчеты

```typescript
// Отчет по выручке
GET /api/reports/revenue?dateFrom=2024-11-01&dateTo=2024-11-30&groupBy=day

// Отчет по расходам
GET /api/reports/expenses?dateFrom=2024-11-01&dateTo=2024-11-30

// Отчет прибыли и убытков
GET /api/reports/profit-loss?dateFrom=2024-11-01&dateTo=2024-11-30
```

### 7.2. Отчеты по посещаемости

```typescript
// Посещаемость по группам
GET /api/reports/studios/attendance?studioId=uuid&dateFrom=2024-11-01&dateTo=2024-11-30

// Посещаемость клиента
GET /api/reports/clients/:clientId/attendance?dateFrom=2024-11-01&dateTo=2024-11-30
```

### 7.3. Отчеты по загруженности

```typescript
// Загруженность помещений
GET /api/reports/rooms/occupancy?dateFrom=2024-11-01&dateTo=2024-11-30

// Загруженность групп
GET /api/reports/groups/capacity?studioId=uuid
```

### 7.4. Отчеты по эффективности

```typescript
// Эффективность преподавателей
GET /api/reports/teachers/performance?dateFrom=2024-11-01&dateTo=2024-11-30

// Эффективность менеджеров
GET /api/reports/managers/performance?dateFrom=2024-11-01&dateTo=2024-11-30
```

### 7.5. Дашборд

```typescript
// Главный дашборд
GET /api/dashboard?dateFrom=2024-11-01&dateTo=2024-11-30
```

---

## 8. Экспорт данных

Все отчеты поддерживают экспорт в форматах:
- **Excel** (.xlsx)
- **CSV** (.csv)
- **PDF** (для печатных отчетов)

**Пример:**
```
GET /api/reports/revenue/export?format=xlsx&dateFrom=2024-11-01&dateTo=2024-11-30
```

---

## Заключение

Модуль Отчетности обеспечивает комплексную аналитику по всем аспектам деятельности культурного центра:

- ✅ Финансовые отчеты (выручка, расходы, прибыль)
- ✅ Отчеты по посещаемости
- ✅ Отчеты по загруженности
- ✅ Отчеты по эффективности сотрудников
- ✅ Интерактивный дашборд
- ✅ Экспорт данных в Excel/CSV/PDF

Этот модуль использует данные из всех других модулей системы для формирования сводной аналитики и поддержки принятия управленческих решений.
