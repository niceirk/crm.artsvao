# ÐœÐ¾Ð´ÑƒÐ»ÑŒ 4: ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ Ð¸ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸

**Ð’ÐµÑ€ÑÐ¸Ñ:** 1.0
**Ð”Ð°Ñ‚Ð°:** 2025-11-13
**Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** Ð’ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ

---

## Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ

1. [ÐžÐ±Ñ‰ÐµÐµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ](#1-Ð¾Ð±Ñ‰ÐµÐµ-Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ)
2. [Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…](#2-ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹-Ð´Ð°Ð½Ð½Ñ‹Ñ…)
3. [Ð‘Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹](#3-Ð±Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹)
4. [Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…](#4-Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ-Ð´Ð°Ð½Ð½Ñ‹Ñ…)
5. [UI/UX ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ](#5-uiux-ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ)
6. [API ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹](#6-api-ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹)
7. [Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¸](#7-Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¸)
8. [ÐŸÑ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°](#8-Ð¿Ñ€Ð°Ð²Ð°-Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°)

---

## 1. ÐžÐ±Ñ‰ÐµÐµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ

### 1.1. ÐÐ°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ñ

ÐœÐ¾Ð´ÑƒÐ»ÑŒ **ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ Ð¸ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸** Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²:
- ÐŸÑ€Ð¾Ð´Ð°Ð¶Ð° Ð¸ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ðµ
- ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð»ÑŒÐ³Ð¾Ñ‚ Ð´Ð»Ñ Ð»ÑŒÐ³Ð¾Ñ‚Ð½Ñ‹Ñ… ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹
- ÐšÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ¾Ð² Ð¿Ð¾ Ð±Ð¾Ð»ÐµÐ·Ð½Ð¸
- Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ ÑÑ€ÐµÐ´ÑÑ‚Ð² Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ðµ
- Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð½Ñ‹Ð¼Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸

### 1.2. ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸

**Ð”Ð»Ñ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð¾Ð²:**
- ÐžÑ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²
- ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- Ð’Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‡ÐµÑ‚Ð¾Ð² Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ
- ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ (Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ, Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð», ÐºÐ²Ð¸Ñ‚Ð°Ð½Ñ†Ð¸Ñ)
- Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ ÑÑ€ÐµÐ´ÑÑ‚Ð² Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ðµ

**Ð”Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²:**
- ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- ÐžÐ½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ð° Ñ‡ÐµÑ€ÐµÐ· Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ°Ð±Ð¸Ð½ÐµÑ‚ (Ð®ÐšÐ°ÑÑÐ°)
- Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹
- ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹ Ð¾ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ð¸

**Ð”Ð»Ñ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²:**
- ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ†ÐµÐ½Ð¾Ð¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ñ
- ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ñ‹Ñ… Ð¾Ñ‚Ñ‡ÐµÑ‚Ð¾Ð²
- Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð»ÑŒÐ³Ð¾Ñ‚Ð°Ð¼Ð¸

### 1.3. ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ ÐºÐ¾Ð½Ñ†ÐµÐ¿Ñ†Ð¸Ð¸

#### Ð¢Ð¸Ð¿ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
- **ÐŸÐ¾ ÑÑ€Ð¾ÐºÑƒ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ** â€” Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð´ÐµÐ¹ÑÑ‚Ð²ÑƒÐµÑ‚ 1 Ð¼ÐµÑÑÑ†, Ð½ÐµÐ¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð·Ð°Ð½ÑÑ‚Ð¸Ð¹ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ñ€Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ñ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹
- **Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹** â€” Ð´Ð»Ñ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ñ… ÑÑ‚ÑƒÐ´Ð¸Ð¹ (isFree = true)
- **ÐŸÐ»Ð°Ñ‚Ð½Ñ‹Ð¹** â€” Ð´Ð»Ñ Ð¿Ð»Ð°Ñ‚Ð½Ñ‹Ñ… ÑÑ‚ÑƒÐ´Ð¸Ð¹

#### Ð–Ð¸Ð·Ð½ÐµÐ½Ð½Ñ‹Ð¹ Ñ†Ð¸ÐºÐ» Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
```
PENDING â†’ ACTIVE â†’ EXPIRED â†’ RENEWED (â†’ ACTIVE)
          â†“
       CANCELLED
```

#### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ
1. Ð—Ð° 7 Ð´Ð½ÐµÐ¹ Ð´Ð¾ Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ñ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ÑÑ ÑÑ‡ÐµÑ‚ (invoice)
2. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
3. ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¾Ð¿Ð»Ð°Ñ‡Ð¸Ð²Ð°ÐµÑ‚ ÑÑ‡ÐµÑ‚ (Ð»ÑŽÐ±Ñ‹Ð¼ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¼ ÑÐ¿Ð¾ÑÐ¾Ð±Ð¾Ð¼)
4. ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ²Ð°ÐµÑ‚ÑÑ Ð½Ð° ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð¼ÐµÑÑÑ†
5. Ð•ÑÐ»Ð¸ Ð½Ðµ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð¾ Ð±Ð¾Ð»ÐµÐµ 14 Ð´Ð½ÐµÐ¹ Ð¿Ð¾ÑÐ»Ðµ Ð¸ÑÑ‚ÐµÑ‡ÐµÐ½Ð¸Ñ â€” Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ñ‚Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ðµ Ð¸Ð· Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹

---

## 2. Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

### 2.1. SubscriptionType (Ð¢Ð¸Ð¿ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°)

Ð¨Ð°Ð±Ð»Ð¾Ð½ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð´Ð»Ñ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹.

```prisma
model SubscriptionType {
  id              String    @id @default(uuid())
  groupId         String    @map("group_id")
  name            String    @db.VarChar(100)  // ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: "ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð½Ð° 1 Ð¼ÐµÑÑÑ†"
  duration        Int       // Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð² Ð´Ð½ÑÑ… (30 Ð´Ð»Ñ 1 Ð¼ÐµÑÑÑ†Ð°)
  price           Decimal   @db.Decimal(10, 2)
  isFree          Boolean   @default(false) @map("is_free")  // Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ð¹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚

  // Ð¡Ð²ÑÐ·Ð¸
  group           Group     @relation(fields: [groupId], references: [id], onDelete: Cascade)
  subscriptions   Subscription[]

  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@map("subscription_types")
  @@index([groupId])
}
```

**ÐŸÐ¾Ð»Ñ:**
- `id` â€” UUID, Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
- `groupId` â€” ID Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹, Ð´Ð»Ñ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð¿Ñ€ÐµÐ´Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚
- `name` â€” ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
- `duration` â€” Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð² Ð´Ð½ÑÑ… (Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ 30)
- `price` â€” Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° (Ð´Ð¾ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð»ÑŒÐ³Ð¾Ñ‚)
- `isFree` â€” Ð¤Ð»Ð°Ð³ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð¾Ð³Ð¾ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° (Ð´Ð»Ñ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ñ… ÑÑ‚ÑƒÐ´Ð¸Ð¹)

---

### 2.2. Subscription (ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°)

ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¸Ð»Ð¸ Ð¸ÑÑ‚ÐµÐºÑˆÐ¸Ð¹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°.

```prisma
model Subscription {
  id                  String              @id @default(uuid())
  subscriptionTypeId  String              @map("subscription_type_id")
  clientId            String              @map("client_id")
  groupId             String              @map("group_id")

  // Ð”Ð°Ñ‚Ñ‹
  startDate           DateTime            @map("start_date") @db.Date
  endDate             DateTime            @map("end_date") @db.Date

  // Ð¦ÐµÐ½Ñ‹ Ð¸ ÑÐºÐ¸Ð´ÐºÐ¸
  basePrice           Decimal             @map("base_price") @db.Decimal(10, 2)  // Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð°
  discountPercentage  Decimal?            @map("discount_percentage") @db.Decimal(5, 2)  // ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð»ÑŒÐ³Ð¾Ñ‚Ñ‹
  finalPrice          Decimal             @map("final_price") @db.Decimal(10, 2)  // Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð° Ð¿Ð¾ÑÐ»Ðµ Ð»ÑŒÐ³Ð¾Ñ‚

  // ÐšÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ
  compensationAmount  Decimal             @default(0) @map("compensation_amount") @db.Decimal(10, 2)  // ÐÐ°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð½Ð°Ñ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ Ð·Ð° Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ¸

  // Ð¡Ñ‚Ð°Ñ‚ÑƒÑ
  status              SubscriptionStatus  @default(PENDING)

  // Ð¡Ð²ÑÐ·Ð¸
  subscriptionType    SubscriptionType    @relation(fields: [subscriptionTypeId], references: [id], onDelete: Restrict)
  client              Client              @relation(fields: [clientId], references: [id], onDelete: Cascade)
  group               Group               @relation(fields: [groupId], references: [id], onDelete: Restrict)
  invoices            Invoice[]
  payments            Payment[]

  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")

  @@map("subscriptions")
  @@index([clientId])
  @@index([groupId])
  @@index([status])
  @@index([endDate])
}

enum SubscriptionStatus {
  PENDING     // ÐžÐ¶Ð¸Ð´Ð°ÐµÑ‚ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ (Ð½Ð¾Ð²Ñ‹Ð¹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚)
  ACTIVE      // ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ (Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½)
  EXPIRED     // Ð˜ÑÑ‚ÐµÐº ÑÑ€Ð¾Ðº Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (Ð½Ðµ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½)
  CANCELLED   // ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½ (Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ ÑÑ€ÐµÐ´ÑÑ‚Ð²)
}
```

**ÐŸÐ¾Ð»Ñ:**
- `id` â€” UUID, Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
- `subscriptionTypeId` â€” ID Ñ‚Ð¸Ð¿Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° (ÑˆÐ°Ð±Ð»Ð¾Ð½)
- `clientId` â€” ID ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
- `groupId` â€” ID Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹
- `startDate` â€” Ð”Ð°Ñ‚Ð° Ð½Ð°Ñ‡Ð°Ð»Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
- `endDate` â€” Ð”Ð°Ñ‚Ð° Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ñ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
- `basePrice` â€” Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° (Ð¸Ð· SubscriptionType)
- `discountPercentage` â€” ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ ÑÐºÐ¸Ð´ÐºÐ¸ Ð¿Ð¾ Ð»ÑŒÐ³Ð¾Ñ‚Ð½Ð¾Ð¹ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (Ð¸Ð· BenefitCategory ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°)
- `finalPrice` â€” Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð° Ð¿Ð¾ÑÐ»Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð»ÑŒÐ³Ð¾Ñ‚Ñ‹
- `compensationAmount` â€” ÐÐ°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð½Ð°Ñ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ Ð·Ð° Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ¸ Ð¿Ð¾ Ð±Ð¾Ð»ÐµÐ·Ð½Ð¸
- `status` â€” Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° (PENDING / ACTIVE / EXPIRED / CANCELLED)

---

### 2.3. Invoice (Ð¡Ñ‡ÐµÑ‚ Ð½Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ)

Ð¡Ñ‡ÐµÑ‚, Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ Ð´Ð»Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°.

```prisma
model Invoice {
  id              String         @id @default(uuid())
  subscriptionId  String         @map("subscription_id")
  clientId        String         @map("client_id")
  amount          Decimal        @db.Decimal(10, 2)
  status          InvoiceStatus  @default(PENDING)
  issuedAt        DateTime       @default(now()) @map("issued_at")
  dueDate         DateTime       @map("due_date") @db.Date
  paidAt          DateTime?      @map("paid_at")

  // Ð¡Ð²ÑÐ·Ð¸
  subscription    Subscription   @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  client          Client         @relation(fields: [clientId], references: [id], onDelete: Cascade)
  payment         Payment?

  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")

  @@map("invoices")
  @@index([subscriptionId])
  @@index([clientId])
  @@index([status])
  @@index([dueDate])
}

enum InvoiceStatus {
  PENDING     // ÐžÐ¶Ð¸Ð´Ð°ÐµÑ‚ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
  PAID        // ÐžÐ¿Ð»Ð°Ñ‡ÐµÐ½
  OVERDUE     // ÐŸÑ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½
  CANCELLED   // ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½
}
```

**ÐŸÐ¾Ð»Ñ:**
- `id` â€” UUID, Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
- `subscriptionId` â€” ID Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°, Ð´Ð»Ñ ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð³Ð¾ Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½ ÑÑ‡ÐµÑ‚
- `clientId` â€” ID ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
- `amount` â€” Ð¡ÑƒÐ¼Ð¼Ð° Ðº Ð¾Ð¿Ð»Ð°Ñ‚Ðµ (Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð»ÑŒÐ³Ð¾Ñ‚ Ð¸ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸)
- `status` â€” Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÑÑ‡ÐµÑ‚Ð° (PENDING / PAID / OVERDUE / CANCELLED)
- `issuedAt` â€” Ð”Ð°Ñ‚Ð° Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÑ‡ÐµÑ‚Ð°
- `dueDate` â€” Ð¡Ñ€Ð¾Ðº Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ (Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾ = endDate Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°)
- `paidAt` â€” Ð”Ð°Ñ‚Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ (ÐµÑÐ»Ð¸ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½)

---

### 2.4. Payment (ÐŸÐ»Ð°Ñ‚ÐµÐ¶)

Ð¤Ð°ÐºÑ‚ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ ÑÑ‡ÐµÑ‚Ð° ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð¼.

```prisma
model Payment {
  id              String        @id @default(uuid())
  invoiceId       String?       @map("invoice_id")    // Ð”Ð»Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
  rentalId        String?       @map("rental_id")     // Ð”Ð»Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ Ð°Ñ€ÐµÐ½Ð´Ñ‹ Ð¿Ð¾Ð¼ÐµÑ‰ÐµÐ½Ð¸Ð¹
  clientId        String        @map("client_id")
  amount          Decimal       @db.Decimal(10, 2)
  paymentMethod   PaymentMethod @map("payment_method")
  status          PaymentStatus @default(PENDING)

  // Ð”Ð°Ð½Ð½Ñ‹Ðµ Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸
  transactionId   String?       @unique @map("transaction_id")  // ID Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð² Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð½Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ (Ð®ÐšÐ°ÑÑÐ°)

  paidAt          DateTime?     @map("paid_at")

  // Ð¡Ð²ÑÐ·Ð¸
  invoice         Invoice?      @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  rental          Rental?       @relation(fields: [rentalId], references: [id], onDelete: Cascade)
  client          Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)

  createdAt       DateTime      @default(now()) @map("created_at")
  updatedAt       DateTime      @updatedAt @map("updated_at")

  @@map("payments")
  @@index([invoiceId])
  @@index([rentalId])
  @@index([clientId])
  @@index([status])
  @@index([paidAt])
}

enum PaymentMethod {
  CASH                // ÐÐ°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ Ð² ÐºÐ°ÑÑÐµ
  CARD_TERMINAL       // Ð‘Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ°Ñ ÐºÐ°Ñ€Ñ‚Ð° (Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð» Ð² Ñ†ÐµÐ½Ñ‚Ñ€Ðµ)
  ONLINE              // ÐžÐ½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð®ÐšÐ°ÑÑÐ°)
  BANK_TRANSFER       // Ð‘Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ¸Ð¹ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´ (Ð¾Ð¿Ð»Ð°Ñ‚Ð° Ð¿Ð¾ ÐºÐ²Ð¸Ñ‚Ð°Ð½Ñ†Ð¸Ð¸)
}

enum PaymentStatus {
  PENDING     // ÐžÐ¶Ð¸Ð´Ð°ÐµÑ‚ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
  PROCESSING  // Ð’ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐµ (Ð´Ð»Ñ Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹)
  COMPLETED   // ÐžÐ¿Ð»Ð°Ñ‡ÐµÐ½Ð¾
  FAILED      // ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
  REFUNDED    // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¾
}
```

**ÐŸÐ¾Ð»Ñ:**
- `id` â€” UUID, Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
- `invoiceId` â€” ID ÑÑ‡ÐµÑ‚Ð° Ð·Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð´Ð»Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²)
- `rentalId` â€” ID Ð°Ñ€ÐµÐ½Ð´Ñ‹ Ð¿Ð¾Ð¼ÐµÑ‰ÐµÐ½Ð¸Ñ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð´Ð»Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ Ð°Ñ€ÐµÐ½Ð´Ñ‹)
- `clientId` â€” ID ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
- `amount` â€” Ð¡ÑƒÐ¼Ð¼Ð° Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°
- `paymentMethod` â€” Ð¡Ð¿Ð¾ÑÐ¾Ð± Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ (CASH / CARD_TERMINAL / ONLINE / BANK_TRANSFER)
- `status` â€” Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð° (PENDING / PROCESSING / COMPLETED / FAILED / REFUNDED)
- `transactionId` â€” ID Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸Ð¸ Ð² Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð½Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ (Ð´Ð»Ñ Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹)
- `paidAt` â€” Ð”Ð°Ñ‚Ð° Ð¸ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹

**Ð’Ð°Ð¶Ð½Ð¾:** ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¸Ð¼ÐµÑ‚ÑŒ Ð»Ð¸Ð±Ð¾ `invoiceId` (Ð´Ð»Ñ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²), Ð»Ð¸Ð±Ð¾ `rentalId` (Ð´Ð»Ñ Ð°Ñ€ÐµÐ½Ð´Ñ‹).
Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒ, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾ Ñ€Ð¾Ð²Ð½Ð¾ Ð¾Ð´Ð½Ð¾ Ð¸Ð· ÑÑ‚Ð¸Ñ… Ð¿Ð¾Ð»ÐµÐ¹.

---

### 2.5. Refund (Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ ÑÑ€ÐµÐ´ÑÑ‚Ð²)

Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ ÑÑ€ÐµÐ´ÑÑ‚Ð² ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°.

```prisma
model Refund {
  id              String       @id @default(uuid())
  paymentId       String       @map("payment_id")
  clientId        String       @map("client_id")
  amount          Decimal      @db.Decimal(10, 2)
  reason          String       @db.Text
  status          RefundStatus @default(PENDING)

  refundedAt      DateTime?    @map("refunded_at")

  // Ð¡Ð²ÑÐ·Ð¸
  payment         Payment      @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  client          Client       @relation(fields: [clientId], references: [id], onDelete: Cascade)

  createdAt       DateTime     @default(now()) @map("created_at")
  updatedAt       DateTime     @updatedAt @map("updated_at")

  @@map("refunds")
  @@index([paymentId])
  @@index([clientId])
  @@index([status])
}

enum RefundStatus {
  PENDING     // ÐžÐ¶Ð¸Ð´Ð°ÐµÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸
  APPROVED    // ÐžÐ´Ð¾Ð±Ñ€ÐµÐ½
  COMPLETED   // Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½
  REJECTED    // ÐžÑ‚ÐºÐ»Ð¾Ð½ÐµÐ½
}
```

**ÐŸÐ¾Ð»Ñ:**
- `id` â€” UUID, Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
- `paymentId` â€” ID Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ
- `clientId` â€” ID ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
- `amount` â€” Ð¡ÑƒÐ¼Ð¼Ð° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð° (Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚)
- `reason` â€” ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð°
- `status` â€” Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð° (PENDING / APPROVED / COMPLETED / REJECTED)
- `refundedAt` â€” Ð”Ð°Ñ‚Ð° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð°

---

### 2.6. Compensation (ÐšÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ Ð·Ð° Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ¸)

ÐšÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ Ð·Ð° Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ¸ Ð¿Ð¾ Ð±Ð¾Ð»ÐµÐ·Ð½Ð¸.

```prisma
model Compensation {
  id              String    @id @default(uuid())
  clientId        String    @map("client_id")
  subscriptionId  String    @map("subscription_id")
  attendanceId    String    @unique @map("attendance_id")  // Ð¡Ð²ÑÐ·ÑŒ Ñ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ¾Ð¼
  amount          Decimal   @db.Decimal(10, 2)
  reason          String    @db.Text
  appliedAt       DateTime? @map("applied_at")  // Ð”Ð°Ñ‚Ð° Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ðº ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼Ñƒ ÑÑ‡ÐµÑ‚Ñƒ

  // Ð¡Ð²ÑÐ·Ð¸
  client          Client      @relation(fields: [clientId], references: [id], onDelete: Cascade)
  subscription    Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  attendance      Attendance  @relation(fields: [attendanceId], references: [id], onDelete: Cascade)

  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@map("compensations")
  @@index([clientId])
  @@index([subscriptionId])
}
```

**ÐŸÐ¾Ð»Ñ:**
- `id` â€” UUID, Ð¿ÐµÑ€Ð²Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
- `clientId` â€” ID ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
- `subscriptionId` â€” ID Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
- `attendanceId` â€” ID Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð¿Ð¾ÑÐµÑ‰Ð°ÐµÐ¼Ð¾ÑÑ‚Ð¸ (Ð¿Ñ€Ð¾Ð¿ÑƒÑÐº Ð¿Ð¾ Ð±Ð¾Ð»ÐµÐ·Ð½Ð¸)
- `amount` â€” Ð¡ÑƒÐ¼Ð¼Ð° ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸ (ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ 1 Ð·Ð°Ð½ÑÑ‚Ð¸Ñ)
- `reason` â€” ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð° ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: "Ð‘Ð¾Ð»ÐµÐ», ÐµÑÑ‚ÑŒ ÑÐ¿Ñ€Ð°Ð²ÐºÐ°")
- `appliedAt` â€” Ð”Ð°Ñ‚Ð° Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸ Ðº ÑÑ‡ÐµÑ‚Ñƒ

---

## 3. Ð‘Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑ‹

### 3.1. ÐžÑ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°

**Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¸:** ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€, ÐšÐ»Ð¸ÐµÐ½Ñ‚

**ÐŸÑ€Ð¾Ñ†ÐµÑÑ:**
1. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ð² CRM
2. ÐšÐ»Ð¸ÐµÐ½Ñ‚ ÑƒÐ¶Ðµ Ð·Ð°Ð¿Ð¸ÑÐ°Ð½ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ (ÑÐ¼. Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð¡Ñ‚ÑƒÐ´Ð¸Ð¹)
3. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð²Ñ‹Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ñ‚Ð¸Ð¿ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð´Ð»Ñ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹
4. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ñ€Ð°ÑÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð»ÑŒÐ³Ð¾Ñ‚Ñ‹ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°:
   ```typescript
   const basePrice = subscriptionType.price;
   const discountPercentage = client.benefitCategory?.discountPercentage || 0;
   const finalPrice = basePrice * (1 - discountPercentage / 100);
   ```
5. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´Ð°ÐµÑ‚ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ
6. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Subscription ÑÐ¾ ÑÑ‚Ð°Ñ‚ÑƒÑÐ¾Ð¼ PENDING:
   ```typescript
   const subscription = await createSubscription({
     subscriptionTypeId: subscriptionType.id,
     clientId: client.id,
     groupId: group.id,
     startDate: new Date(),
     endDate: addDays(new Date(), subscriptionType.duration),
     basePrice,
     discountPercentage,
     finalPrice,
     status: 'PENDING',
   });
   ```
7. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Invoice (ÑÑ‡ÐµÑ‚ Ð½Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ):
   ```typescript
   const invoice = await createInvoice({
     subscriptionId: subscription.id,
     clientId: client.id,
     amount: finalPrice,
     dueDate: subscription.endDate,
     status: 'PENDING',
   });
   ```
8. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°ÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ ÑÐ¿Ð¾ÑÐ¾Ð± Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹:
   - ÐÐ°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ Ð² ÐºÐ°ÑÑÐµ
   - Ð‘Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ°Ñ ÐºÐ°Ñ€Ñ‚Ð° (Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»)
   - ÐžÐ½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð®ÐšÐ°ÑÑÐ°) â€” Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÑÑÑ‹Ð»ÐºÐ¸ Ð½Ð° email
   - ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð¿Ð¾ ÐºÐ²Ð¸Ñ‚Ð°Ð½Ñ†Ð¸Ð¸

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ ÑÐ¾Ð·Ð´Ð°Ð½, ÑÑ‡ÐµÑ‚ Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½, Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚ÑÑ Ð¾Ð¿Ð»Ð°Ñ‚Ð°

---

### 3.2. ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°

**Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 1: ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ Ð¸Ð»Ð¸ ÐºÐ°Ñ€Ñ‚Ð¾Ð¹ (Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»)**

1. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ Ð¾Ñ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
2. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ:
   ```typescript
   const payment = await createPayment({
     invoiceId: invoice.id,
     clientId: client.id,
     amount: invoice.amount,
     paymentMethod: 'CASH', // Ð¸Ð»Ð¸ 'CARD_TERMINAL'
     status: 'COMPLETED',
     paidAt: new Date(),
   });
   ```
3. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸:
   - ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ ÑÑ‚Ð°Ñ‚ÑƒÑ Invoice: PENDING â†’ PAID
   - ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ ÑÑ‚Ð°Ñ‚ÑƒÑ Subscription: PENDING â†’ ACTIVE
   - ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ (email/SMS)

**Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 2: ÐžÐ½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð®ÐšÐ°ÑÑÐ°)**

1. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð¸Ð»Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚ Ð¸Ð½Ð¸Ñ†Ð¸Ð¸Ñ€ÑƒÐµÑ‚ Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ
2. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ ÑÐ¾ ÑÑ‚Ð°Ñ‚ÑƒÑÐ¾Ð¼ PENDING:
   ```typescript
   const payment = await createPayment({
     invoiceId: invoice.id,
     clientId: client.id,
     amount: invoice.amount,
     paymentMethod: 'ONLINE',
     status: 'PENDING',
   });
   ```
3. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ Ð² Ð®ÐšÐ°ÑÑÐ°:
   ```typescript
   const yukassaPayment = await yukassa.createPayment({
     amount: {
       value: payment.amount.toFixed(2),
       currency: 'RUB',
     },
     confirmation: {
       type: 'redirect',
       return_url: `${BASE_URL}/payments/${payment.id}/success`,
     },
     metadata: {
       paymentId: payment.id,
       invoiceId: invoice.id,
     },
   });
   ```
4. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ ÑÑÑ‹Ð»ÐºÑƒ Ð½Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ
5. ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ñ‚ Ð¿Ð¾ ÑÑÑ‹Ð»ÐºÐµ Ð¸ Ð¾Ð¿Ð»Ð°Ñ‡Ð¸Ð²Ð°ÐµÑ‚
6. Ð®ÐšÐ°ÑÑÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ webhook Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¾Ð¼ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
7. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ webhook:
   ```typescript
   // Ð•ÑÐ»Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ð° ÑƒÑÐ¿ÐµÑˆÐ½Ð°
   await updatePayment(payment.id, {
     status: 'COMPLETED',
     transactionId: yukassaPayment.id,
     paidAt: new Date(),
   });

   await updateInvoice(invoice.id, { status: 'PAID', paidAt: new Date() });
   await updateSubscription(subscription.id, { status: 'ACTIVE' });

   // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ
   await sendNotification(client.id, { type: 'PAYMENT_SUCCESS' });
   ```

**Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 3: ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð¿Ð¾ ÐºÐ²Ð¸Ñ‚Ð°Ð½Ñ†Ð¸Ð¸ (Ð±Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ¸Ð¹ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´)**

1. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ñ„Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÑ‚ ÐºÐ²Ð¸Ñ‚Ð°Ð½Ñ†Ð¸ÑŽ Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ñ Ñ€ÐµÐºÐ²Ð¸Ð·Ð¸Ñ‚Ð°Ð¼Ð¸
2. ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¾Ð¿Ð»Ð°Ñ‡Ð¸Ð²Ð°ÐµÑ‚ Ð² Ð±Ð°Ð½ÐºÐµ
3. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ Ð¾Ñ‚Ð¼ÐµÑ‡Ð°ÐµÑ‚ Ð¾Ð¿Ð»Ð°Ñ‚Ñƒ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ Ð¿Ð¾ÑÐ»Ðµ Ð¿Ð¾ÑÑ‚ÑƒÐ¿Ð»ÐµÐ½Ð¸Ñ ÑÑ€ÐµÐ´ÑÑ‚Ð²
4. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ (Ð°Ð½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð¾ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸ÑŽ 1)

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½ Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½

---

### 3.3. ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°

**Ð¤Ð¾Ð½Ð¾Ð²Ð°Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° (cron job), Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾**

```typescript
async function processSubscriptionRenewals() {
  // 1. ÐÐ°Ð¹Ñ‚Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð·Ð°ÐºÐ°Ð½Ñ‡Ð¸Ð²Ð°ÑŽÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· 7 Ð´Ð½ÐµÐ¹
  const subscriptionsToRenew = await findSubscriptionsExpiringSoon({
    daysUntilExpiry: 7,
    status: 'ACTIVE',
  });

  for (const subscription of subscriptionsToRenew) {
    // 2. Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð¼ÐµÑÑÑ†Ð° Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸
    const basePrice = subscription.subscriptionType.price;
    const discountPercentage = subscription.client.benefitCategory?.discountPercentage || 0;
    const priceAfterDiscount = basePrice * (1 - discountPercentage / 100);

    const compensationAmount = subscription.compensationAmount || 0;
    const finalPrice = Math.max(0, priceAfterDiscount - compensationAmount);

    // 3. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ ÑÑ‡ÐµÑ‚ Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ
    const renewalInvoice = await createInvoice({
      subscriptionId: subscription.id,
      clientId: subscription.clientId,
      amount: finalPrice,
      dueDate: addDays(subscription.endDate, 1),
      status: 'PENDING',
    });

    // 4. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
    await sendNotification(subscription.clientId, {
      type: 'SUBSCRIPTION_RENEWAL_DUE',
      data: {
        invoiceId: renewalInvoice.id,
        amount: finalPrice,
        dueDate: renewalInvoice.dueDate,
      },
    });
  }
}
```

**ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð¿Ð¾ÑÐ»Ðµ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ ÑÑ‡ÐµÑ‚Ð° Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ:**

1. ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¾Ð¿Ð»Ð°Ñ‡Ð¸Ð²Ð°ÐµÑ‚ ÑÑ‡ÐµÑ‚ (Ð»ÑŽÐ±Ñ‹Ð¼ ÑÐ¿Ð¾ÑÐ¾Ð±Ð¾Ð¼)
2. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Payment
3. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ²Ð°ÐµÑ‚ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚:
   ```typescript
   await updateSubscription(subscription.id, {
     startDate: addDays(subscription.endDate, 1),
     endDate: addDays(subscription.endDate, subscription.subscriptionType.duration + 1),
     compensationAmount: 0, // ÐšÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð°, Ð¾Ð±Ð½ÑƒÐ»ÑÐµÐ¼
     status: 'ACTIVE',
   });
   ```
4. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½ Ð½Ð° ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð¼ÐµÑÑÑ†

---

### 3.4. ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ñ‚Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ðµ Ð·Ð° Ð½ÐµÑƒÐ¿Ð»Ð°Ñ‚Ñƒ

**Ð¤Ð¾Ð½Ð¾Ð²Ð°Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° (cron job), Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾**

```typescript
async function processOverdueSubscriptions() {
  // 1. ÐÐ°Ð¹Ñ‚Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¸ÑÑ‚ÐµÐºÐ»Ð¸ Ð±Ð¾Ð»ÐµÐµ 14 Ð´Ð½ÐµÐ¹ Ð½Ð°Ð·Ð°Ð´ Ð¸ Ð½Ðµ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ñ‹
  const overdueSubscriptions = await findOverdueSubscriptions({
    daysOverdue: 14,
    status: 'ACTIVE',
  });

  for (const subscription of overdueSubscriptions) {
    // 2. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð½ÐµÐ¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð½Ñ‹Ñ… ÑÑ‡ÐµÑ‚Ð¾Ð²
    const unpaidInvoices = await findUnpaidInvoices(subscription.id);

    if (unpaidInvoices.length > 0) {
      // 3. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
      await updateSubscription(subscription.id, { status: 'EXPIRED' });

      // 4. ÐžÑ‚Ñ‡Ð¸ÑÐ»Ð¸Ñ‚ÑŒ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ð¸Ð· Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ (ÑÐ¼. Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð¡Ñ‚ÑƒÐ´Ð¸Ð¹)
      await updateGroupMember({
        groupId: subscription.groupId,
        clientId: subscription.clientId,
        status: 'EXPELLED',
        notes: 'ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ñ‚Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ðµ Ð·Ð° Ð½ÐµÑƒÐ¿Ð»Ð°Ñ‚Ñƒ (14+ Ð´Ð½ÐµÐ¹)',
      });

      // 5. ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð²ÑÐµ Ð½ÐµÐ¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð½Ñ‹Ðµ ÑÑ‡ÐµÑ‚Ð°
      for (const invoice of unpaidInvoices) {
        await updateInvoice(invoice.id, { status: 'CANCELLED' });
      }

      // 6. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
      await sendNotification(subscription.clientId, {
        type: 'SUBSCRIPTION_EXPIRED',
        data: { groupName: subscription.group.name },
      });
    }
  }
}
```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ñ‚Ñ‡Ð¸ÑÐ»ÐµÐ½ Ð¸Ð· Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹, Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð¸ÑÑ‚ÐµÐº

---

### 3.5. ÐšÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ Ð·Ð° Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ¸ Ð¿Ð¾ Ð±Ð¾Ð»ÐµÐ·Ð½Ð¸

**Ð¢Ñ€Ð¸Ð³Ð³ÐµÑ€:** ÐŸÑ€ÐµÐ¿Ð¾Ð´Ð°Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¾Ñ‚Ð¼ÐµÑ‡Ð°ÐµÑ‚ Ð¿Ð¾ÑÐµÑ‰Ð°ÐµÐ¼Ð¾ÑÑ‚ÑŒ ÐºÐ°Ðº SICK Ð¸Ð»Ð¸ EXCUSED

**ÐŸÑ€Ð¾Ñ†ÐµÑÑ:**
1. ÐŸÑ€ÐµÐ¿Ð¾Ð´Ð°Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¾Ñ‚Ð¼ÐµÑ‡Ð°ÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° ÐºÐ°Ðº Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ³Ð¾ Ð¿Ð¾ Ð±Ð¾Ð»ÐµÐ·Ð½Ð¸ (status = SICK)
2. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°:
   ```typescript
   const subscription = await findActiveSubscription(clientId, groupId);
   ```
3. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ñ€Ð°ÑÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð·Ð°Ð½ÑÑ‚Ð¸Ñ:
   ```typescript
   // Ð¡Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð·Ð°Ð½ÑÑ‚Ð¸Ð¹ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð² Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¼ Ð¼ÐµÑÑÑ†Ðµ
   const schedulesCount = await countGroupSchedulesInMonth(groupId, subscription.startDate);
   const lessonPrice = subscription.finalPrice / schedulesCount;
   ```
4. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð·Ð°Ð¿Ð¸ÑÑŒ Compensation:
   ```typescript
   const compensation = await createCompensation({
     clientId,
     subscriptionId: subscription.id,
     attendanceId: attendance.id,
     amount: lessonPrice,
     reason: `ÐŸÑ€Ð¾Ð¿ÑƒÑÐº Ð¿Ð¾ Ð±Ð¾Ð»ÐµÐ·Ð½Ð¸: ${attendance.schedule.date}`,
   });
   ```
5. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÑ‚ compensationAmount Ð² Subscription:
   ```typescript
   await updateSubscription(subscription.id, {
     compensationAmount: subscription.compensationAmount + lessonPrice,
   });
   ```
6. ÐŸÑ€Ð¸ Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ³Ð¾ ÑÑ‡ÐµÑ‚Ð° ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ ÑƒÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ÑÑ:
   ```typescript
   const finalPrice = Math.max(0, priceAfterDiscount - subscription.compensationAmount);
   ```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** ÐšÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ Ð½Ð°ÐºÐ¾Ð¿Ð»ÐµÐ½Ð° Ð¸ Ð±ÑƒÐ´ÐµÑ‚ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð° Ðº ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼Ñƒ ÑÑ‡ÐµÑ‚Ñƒ

---

### 3.6. ÐžÑ‚Ð¼ÐµÐ½Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ ÑÑ€ÐµÐ´ÑÑ‚Ð²

**Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¸:** ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€, ÐšÐ»Ð¸ÐµÐ½Ñ‚

**ÐŸÑ€Ð¾Ñ†ÐµÑÑ:**
1. ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¾Ð±Ñ€Ð°Ñ‰Ð°ÐµÑ‚ÑÑ Ðº Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ñƒ Ñ Ð¿Ñ€Ð¾ÑÑŒÐ±Ð¾Ð¹ Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚
2. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°ÐµÑ‚ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÑƒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
3. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð½Ð°Ð¶Ð¸Ð¼Ð°ÐµÑ‚ "ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚"
4. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ñ€Ð°ÑÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÑÑƒÐ¼Ð¼Ñƒ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð° (Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚):
   ```typescript
   // Ð¡Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð·Ð°Ð½ÑÑ‚Ð¸Ð¹ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð² Ð¼ÐµÑÑÑ†Ðµ
   const totalSchedules = await countGroupSchedulesInMonth(groupId, subscription.startDate);

   // Ð¡Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¾ÑÑ‚Ð°Ð²ÑˆÐ¸Ñ…ÑÑ Ð·Ð°Ð½ÑÑ‚Ð¸Ð¹
   const remainingSchedules = await countGroupSchedulesFromDate(groupId, new Date());

   // Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð·Ð°Ð½ÑÑ‚Ð¸Ñ
   const lessonPrice = subscription.finalPrice / totalSchedules;

   // Ð¡ÑƒÐ¼Ð¼Ð° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð°
   const refundAmount = lessonPrice * remainingSchedules;
   ```
5. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´Ð°ÐµÑ‚ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚
6. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð·Ð°Ð¿Ð¸ÑÑŒ Refund:
   ```typescript
   const refund = await createRefund({
     paymentId: lastPayment.id,
     clientId: subscription.clientId,
     amount: refundAmount,
     reason: 'ÐžÑ‚Ð¼ÐµÐ½Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð¿Ð¾ Ð¶ÐµÐ»Ð°Ð½Ð¸ÑŽ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°',
     status: 'PENDING',
   });
   ```
7. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ ÑÑ‚Ð°Ñ‚ÑƒÑ Subscription: ACTIVE â†’ CANCELLED
8. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ñ‚Ñ‡Ð¸ÑÐ»ÑÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ð¸Ð· Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ (ÑÐ¼. Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð¡Ñ‚ÑƒÐ´Ð¸Ð¹)
9. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ ÑÑ€ÐµÐ´ÑÑ‚Ð² ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ (Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ / Ð½Ð° ÐºÐ°Ñ€Ñ‚Ñƒ)
10. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€ Ð¾Ñ‚Ð¼ÐµÑ‡Ð°ÐµÑ‚ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ ÐºÐ°Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð½Ñ‹Ð¹:
    ```typescript
    await updateRefund(refund.id, {
      status: 'COMPLETED',
      refundedAt: new Date(),
    });
    ```
11. Ð•ÑÐ»Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ð° Ð±Ñ‹Ð»Ð° Ð¾Ð½Ð»Ð°Ð¹Ð½ (Ð®ÐšÐ°ÑÑÐ°), ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ñ‡ÐµÑ€ÐµÐ· API:
    ```typescript
    const yukassaRefund = await yukassa.createRefund({
      payment_id: payment.transactionId,
      amount: {
        value: refundAmount.toFixed(2),
        currency: 'RUB',
      },
    });
    ```

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:** ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½, ÑÑ€ÐµÐ´ÑÑ‚Ð²Ð° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ñ‹ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ

---

### 3.7. ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¾Ð± Ð¾Ð¿Ð»Ð°Ñ‚Ðµ

**Ð¤Ð¾Ð½Ð¾Ð²Ð°Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° (cron job), Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾**

```typescript
async function sendPaymentReminders() {
  // 1. ÐÐ°Ð¹Ñ‚Ð¸ Ð½ÐµÐ¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð½Ñ‹Ðµ ÑÑ‡ÐµÑ‚Ð° Ñ Ð¸ÑÑ‚ÐµÐºÐ°ÑŽÑ‰Ð¸Ð¼ ÑÑ€Ð¾ÐºÐ¾Ð¼ (Ð·Ð° 2-3 Ð´Ð½Ñ Ð´Ð¾ dueDate)
  const invoicesToRemind = await findInvoicesExpiringsoon({
    daysUntilDue: 3,
    status: 'PENDING',
  });

  for (const invoice of invoicesToRemind) {
    // 2. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
    await sendNotification(invoice.clientId, {
      type: 'PAYMENT_REMINDER',
      data: {
        invoiceId: invoice.id,
        amount: invoice.amount,
        dueDate: invoice.dueDate,
      },
    });
  }
}
```

---

### 3.8. Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°

**Ð¤Ð¾Ð½Ð¾Ð²Ð°Ñ Ð·Ð°Ð´Ð°Ñ‡Ð° (cron job), Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ ÐµÐ¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾**

```typescript
async function notifyExpiredSubscriptions() {
  // 1. ÐÐ°Ð¹Ñ‚Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹, ÑÑ€Ð¾Ðº ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ñ… Ð¸ÑÑ‚ÐµÐº ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð¸ Ð½Ðµ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ñ‹
  const expiredSubscriptions = await findExpiredSubscriptions({
    endDate: new Date(),
    status: 'ACTIVE',
  });

  for (const subscription of expiredSubscriptions) {
    // 2. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð½ÐµÐ¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð½Ñ‹Ñ… ÑÑ‡ÐµÑ‚Ð¾Ð²
    const unpaidInvoices = await findUnpaidInvoices(subscription.id);

    if (unpaidInvoices.length > 0) {
      // 3. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° (Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾)
      await updateSubscription(subscription.id, { status: 'EXPIRED' });

      // 4. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
      await sendNotification(subscription.clientId, {
        type: 'SUBSCRIPTION_EXPIRED_WARNING',
        data: {
          groupName: subscription.group.name,
          daysUntilRemoval: 14, // Ð§ÐµÑ€ÐµÐ· 14 Ð´Ð½ÐµÐ¹ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ñ‚Ñ‡Ð¸ÑÐ»ÐµÐ½
        },
      });
    }
  }
}
```

---

## 4. Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…

### 4.1. SubscriptionType (Ð¢Ð¸Ð¿ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°)

| ÐŸÐ¾Ð»Ðµ | ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾ | Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ |
|------|---------|---------------------|
| `name` | ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ, 1-100 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð² | "ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾" |
| `groupId` | Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð°Ñ Ð³Ñ€ÑƒÐ¿Ð¿Ð° | "Ð“Ñ€ÑƒÐ¿Ð¿Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°" |
| `duration` | Ð¦ÐµÐ»Ð¾Ðµ Ñ‡Ð¸ÑÐ»Ð¾ >= 1 | "Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð½Ðµ Ð¼ÐµÐ½ÐµÐµ 1 Ð´Ð½Ñ" |
| `price` | >= 0 | "Ð¦ÐµÐ½Ð° Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹" |
| `isFree` | Boolean | "ÐÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»Ñ" |

**Ð‘Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°:**
- Ð•ÑÐ»Ð¸ ÑÑ‚ÑƒÐ´Ð¸Ñ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð°Ñ (isFree = true), Ñ‚Ð¾ price Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ 0 Ð¸ isFree = true
- ÐÐµÐ»ÑŒÐ·Ñ ÑƒÐ´Ð°Ð»Ð¸Ñ‚ÑŒ Ñ‚Ð¸Ð¿ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°, ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ ÑÑ‚Ð¾Ð³Ð¾ Ñ‚Ð¸Ð¿Ð°

---

### 4.2. Subscription (ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚)

| ÐŸÐ¾Ð»Ðµ | ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾ | Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ |
|------|---------|---------------------|
| `subscriptionTypeId` | Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ Ñ‚Ð¸Ð¿ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° | "Ð¢Ð¸Ð¿ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" |
| `clientId` | Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚ | "ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" |
| `groupId` | Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð°Ñ Ð³Ñ€ÑƒÐ¿Ð¿Ð° | "Ð“Ñ€ÑƒÐ¿Ð¿Ð° Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°" |
| `startDate` | ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ Ð´Ð°Ñ‚Ð° | "ÐÐµÐ²ÐµÑ€Ð½Ð°Ñ Ð´Ð°Ñ‚Ð° Ð½Ð°Ñ‡Ð°Ð»Ð°" |
| `endDate` | ÐŸÐ¾Ð·Ð¶Ðµ startDate | "Ð”Ð°Ñ‚Ð° Ð¾ÐºÐ¾Ð½Ñ‡Ð°Ð½Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð·Ð¶Ðµ Ð´Ð°Ñ‚Ñ‹ Ð½Ð°Ñ‡Ð°Ð»Ð°" |
| `basePrice` | >= 0 | "Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð° Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹" |
| `discountPercentage` | 0-100 Ð¸Ð»Ð¸ null | "ÐŸÑ€Ð¾Ñ†ÐµÐ½Ñ‚ ÑÐºÐ¸Ð´ÐºÐ¸ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚ 0 Ð´Ð¾ 100" |
| `finalPrice` | >= 0 | "Ð˜Ñ‚Ð¾Ð³Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð° Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹" |
| `compensationAmount` | >= 0 | "ÐšÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹" |
| `status` | Ð¢Ð¾Ð»ÑŒÐºÐ¾ PENDING, ACTIVE, EXPIRED, CANCELLED | "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°" |

**Ð‘Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°:**
- Ð£ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð´Ð²ÑƒÑ… Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð´Ð»Ñ Ð¾Ð´Ð½Ð¾Ð¹ Ð¸ Ñ‚Ð¾Ð¹ Ð¶Ðµ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ Ð¾Ð´Ð½Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾
- finalPrice = basePrice * (1 - discountPercentage / 100)
- ÐÐµÐ»ÑŒÐ·Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚, ÐµÑÐ»Ð¸ ÑƒÐ¶Ðµ Ð¸ÑÑ‚ÐµÐº ÑÑ€Ð¾Ðº Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (status = EXPIRED)

---

### 4.3. Invoice (Ð¡Ñ‡ÐµÑ‚)

| ÐŸÐ¾Ð»Ðµ | ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾ | Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ |
|------|---------|---------------------|
| `subscriptionId` | Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ | "ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" |
| `clientId` | Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚ | "ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" |
| `amount` | >= 0 | "Ð¡ÑƒÐ¼Ð¼Ð° ÑÑ‡ÐµÑ‚Ð° Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹" |
| `dueDate` | ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ Ð´Ð°Ñ‚Ð° | "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ÑÑ€Ð¾Ðº Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹" |
| `status` | Ð¢Ð¾Ð»ÑŒÐºÐ¾ PENDING, PAID, OVERDUE, CANCELLED | "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ ÑÑ‡ÐµÑ‚Ð°" |

**Ð‘Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°:**
- ÐÐµÐ»ÑŒÐ·Ñ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ ÑÑ‡ÐµÑ‚ Ð´Ð»Ñ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°, ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ Ð½ÐµÐ¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð½Ñ‹Ð¹ ÑÑ‡ÐµÑ‚
- ÐÐµÐ»ÑŒÐ·Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÑÑ‡ÐµÑ‚, ÐµÑÐ»Ð¸ Ð¾Ð½ ÑƒÐ¶Ðµ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½ (status = PAID)

---

### 4.4. Payment (ÐŸÐ»Ð°Ñ‚ÐµÐ¶)

| ÐŸÐ¾Ð»Ðµ | ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾ | Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ |
|------|---------|---------------------|
| `invoiceId` | Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÑÑ‡ÐµÑ‚ | "Ð¡Ñ‡ÐµÑ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" |
| `clientId` | Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚ | "ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" |
| `amount` | >= 0 | "Ð¡ÑƒÐ¼Ð¼Ð° Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð° Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹" |
| `paymentMethod` | Ð¢Ð¾Ð»ÑŒÐºÐ¾ CASH, CARD_TERMINAL, ONLINE, BANK_TRANSFER | "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ÑÐ¿Ð¾ÑÐ¾Ð± Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹" |
| `status` | Ð¢Ð¾Ð»ÑŒÐºÐ¾ PENDING, PROCESSING, COMPLETED, FAILED, REFUNDED | "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°" |

**Ð‘Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°:**
- ÐÐµÐ»ÑŒÐ·Ñ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ Ð´Ð»Ñ ÑƒÐ¶Ðµ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÑ‡ÐµÑ‚Ð°
- amount Ð´Ð¾Ð»Ð¶Ð½Ð° ÑÐ¾Ð²Ð¿Ð°Ð´Ð°Ñ‚ÑŒ Ñ invoice.amount
- ÐÐµÐ»ÑŒÐ·Ñ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð° Ñ COMPLETED Ð½Ð° Ð´Ñ€ÑƒÐ³Ð¾Ð¹ (ÐºÑ€Ð¾Ð¼Ðµ REFUNDED)

---

### 4.5. Refund (Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚)

| ÐŸÐ¾Ð»Ðµ | ÐŸÑ€Ð°Ð²Ð¸Ð»Ð¾ | Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐµ |
|------|---------|---------------------|
| `paymentId` | Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ | "ÐŸÐ»Ð°Ñ‚ÐµÐ¶ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" |
| `clientId` | Ð¡ÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚ | "ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½" |
| `amount` | > 0 Ð¸ <= payment.amount | "Ð¡ÑƒÐ¼Ð¼Ð° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð° Ð½ÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°" |
| `reason` | ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ | "ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð° Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð° Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°" |
| `status` | Ð¢Ð¾Ð»ÑŒÐºÐ¾ PENDING, APPROVED, COMPLETED, REJECTED | "ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð°" |

**Ð‘Ð¸Ð·Ð½ÐµÑ-Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð°:**
- ÐÐµÐ»ÑŒÐ·Ñ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð´Ð»Ñ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ ÑƒÐ¶Ðµ Ð¸Ð¼ÐµÐµÑ‚ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚
- amount Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐ°Ñ‚ÑŒ ÑÑƒÐ¼Ð¼Ñƒ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°

---

## 5. UI/UX ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ

### 5.1. Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° "ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°"

**ÐœÐ°ÐºÐµÑ‚:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹: Ð˜Ð²Ð°Ð½Ð¾Ð² Ð˜Ð²Ð°Ð½ Ð˜Ð²Ð°Ð½Ð¾Ð²Ð¸Ñ‡               [+ ÐÐ¾Ð²Ñ‹Ð¹]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ Ð’ÐºÐ»Ð°Ð´ÐºÐ¸: [ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ (2)] [Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ (5)]                        â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ âœ… Ð¢Ð°Ð½Ñ†Ñ‹ â€º ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ðµ 5-7 Ð»ÐµÑ‚               [...]       â”‚ â”‚
â”‚ â”‚ Ð”ÐµÐ¹ÑÑ‚Ð²ÑƒÐµÑ‚: 01.11.2024 - 30.11.2024                     â”‚ â”‚
â”‚ â”‚ Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: 4500 Ñ€ÑƒÐ±. (ÑÐºÐ¸Ð´ÐºÐ° 10%)                      â”‚ â”‚
â”‚ â”‚ ÐšÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ: 300 Ñ€ÑƒÐ±. (2 Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ° Ð¿Ð¾ Ð±Ð¾Ð»ÐµÐ·Ð½Ð¸)          â”‚ â”‚
â”‚ â”‚ Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹                                        â”‚ â”‚
â”‚ â”‚ [ÐŸÑ€Ð¾Ð´Ð»Ð¸Ñ‚ÑŒ] [ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ]                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â³ Ð’Ð¾ÐºÐ°Ð» â€º Ð˜Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð·Ð°Ð½ÑÑ‚Ð¸Ñ           [...]       â”‚ â”‚
â”‚ â”‚ Ð”ÐµÐ¹ÑÑ‚Ð²ÑƒÐµÑ‚: 15.11.2024 - 14.12.2024                     â”‚ â”‚
â”‚ â”‚ Ð¡Ñ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ: 8000 Ñ€ÑƒÐ±.                                    â”‚ â”‚
â”‚ â”‚ Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: ÐžÐ¶Ð¸Ð´Ð°ÐµÑ‚ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹                                  â”‚ â”‚
â”‚ â”‚ Ð¡Ñ‡ÐµÑ‚: 8000 Ñ€ÑƒÐ±., Ð¾Ð¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ Ð´Ð¾ 14.12.2024                â”‚ â”‚
â”‚ â”‚ [ÐžÐ¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ] [ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ]                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»:**
- Ð”Ð²Ðµ Ð²ÐºÐ»Ð°Ð´ÐºÐ¸: ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ, Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ
- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ†Ð¸Ñ ÑÑ‚Ð°Ñ‚ÑƒÑÐ°: âœ… ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹, â³ ÐžÐ¶Ð¸Ð´Ð°ÐµÑ‚ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹, âŒ Ð˜ÑÑ‚ÐµÐº, ðŸš« ÐžÑ‚Ð¼ÐµÐ½ÐµÐ½
- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸ Ð·Ð° Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ¸
- ÐšÐ½Ð¾Ð¿ÐºÐ¸ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹: ÐŸÑ€Ð¾Ð´Ð»Ð¸Ñ‚ÑŒ, ÐžÐ¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ, ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ
- ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð½Ð¾Ðµ Ð¼ÐµÐ½ÑŽ [...] Ð´Ð»Ñ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ð¹

---

### 5.2. Ð¤Ð¾Ñ€Ð¼Ð° Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ñ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°

**ÐœÐ°ÐºÐµÑ‚:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ÐžÑ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ ÐšÐ»Ð¸ÐµÐ½Ñ‚: Ð˜Ð²Ð°Ð½Ð¾Ð² Ð˜Ð²Ð°Ð½ Ð˜Ð²Ð°Ð½Ð¾Ð²Ð¸Ñ‡                                â”‚
â”‚ Ð“Ñ€ÑƒÐ¿Ð¿Ð°: Ð¢Ð°Ð½Ñ†Ñ‹ â€º ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ðµ 5-7 Ð»ÐµÑ‚                          â”‚
â”‚                                                               â”‚
â”‚ Ð¢Ð¸Ð¿ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°: [ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð½Ð° 1 Ð¼ÐµÑÑÑ† â–¼]                    â”‚
â”‚                                                               â”‚
â”‚ Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ Ñ†ÐµÐ½Ð°:         5000 Ñ€ÑƒÐ±.                              â”‚
â”‚ Ð›ÑŒÐ³Ð¾Ñ‚Ð½Ð°Ñ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ:   ÐœÐ½Ð¾Ð³Ð¾Ð´ÐµÑ‚Ð½Ð°Ñ ÑÐµÐ¼ÑŒÑ (10%)               â”‚
â”‚ Ð¡ÐºÐ¸Ð´ÐºÐ°:               -500 Ñ€ÑƒÐ±.                              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚ Ð˜Ñ‚Ð¾Ð³Ð¾ Ðº Ð¾Ð¿Ð»Ð°Ñ‚Ðµ:       4500 Ñ€ÑƒÐ±.                              â”‚
â”‚                                                               â”‚
â”‚ ÐŸÐµÑ€Ð¸Ð¾Ð´ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ:      13.11.2024 - 12.12.2024               â”‚
â”‚                                                               â”‚
â”‚ Ð¡Ð¿Ð¾ÑÐ¾Ð± Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹:                                               â”‚
â”‚   â—‹ ÐÐ°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ Ð² ÐºÐ°ÑÑÐµ                                         â”‚
â”‚   â—‹ Ð‘Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ°Ñ ÐºÐ°Ñ€Ñ‚Ð° (Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»)                              â”‚
â”‚   â—‹ ÐžÐ½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð®ÐšÐ°ÑÑÐ°)                                  â”‚
â”‚   â—‹ ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð¿Ð¾ ÐºÐ²Ð¸Ñ‚Ð°Ð½Ñ†Ð¸Ð¸                                      â”‚
â”‚                                                               â”‚
â”‚ [ÐžÑ‚Ð¼ÐµÐ½Ð°]                              [ÐžÑ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚]   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»:**
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ€Ð°ÑÑ‡ÐµÑ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð»ÑŒÐ³Ð¾Ñ‚Ñ‹
- Ð’Ñ‹Ð±Ð¾Ñ€ ÑÐ¿Ð¾ÑÐ¾Ð±Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
- ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€Ð¸Ð¾Ð´Ð° Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ñ

---

### 5.3. Ð¡Ñ‚Ñ€Ð°Ð½Ð¸Ñ†Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ ÑÑ‡ÐµÑ‚Ð°

**ÐœÐ°ÐºÐµÑ‚:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ÐžÐ¿Ð»Ð°Ñ‚Ð° ÑÑ‡ÐµÑ‚Ð° #12345                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ ÐšÐ»Ð¸ÐµÐ½Ñ‚: Ð˜Ð²Ð°Ð½Ð¾Ð² Ð˜Ð²Ð°Ð½ Ð˜Ð²Ð°Ð½Ð¾Ð²Ð¸Ñ‡                                â”‚
â”‚ ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚: Ð¢Ð°Ð½Ñ†Ñ‹ â€º ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ðµ 5-7 Ð»ÐµÑ‚                       â”‚
â”‚                                                               â”‚
â”‚ Ð¡ÑƒÐ¼Ð¼Ð° Ðº Ð¾Ð¿Ð»Ð°Ñ‚Ðµ:       4200 Ñ€ÑƒÐ±.                              â”‚
â”‚ (Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸ 300 Ñ€ÑƒÐ±.)                              â”‚
â”‚                                                               â”‚
â”‚ Ð¡Ñ€Ð¾Ðº Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹:          30.11.2024                             â”‚
â”‚                                                               â”‚
â”‚ Ð¡Ð¿Ð¾ÑÐ¾Ð± Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹:                                               â”‚
â”‚   â—‹ ÐÐ°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ Ð² ÐºÐ°ÑÑÐµ                                         â”‚
â”‚   â—‹ Ð‘Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ°Ñ ÐºÐ°Ñ€Ñ‚Ð° (Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»)                              â”‚
â”‚   â—‹ ÐžÐ½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð®ÐšÐ°ÑÑÐ°)                                  â”‚
â”‚   â—‹ ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð¿Ð¾ ÐºÐ²Ð¸Ñ‚Ð°Ð½Ñ†Ð¸Ð¸                                      â”‚
â”‚                                                               â”‚
â”‚ [ÐžÑ‚Ð¼ÐµÐ½Ð°]                                      [ÐžÐ¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ]     â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»:**
- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ ÑÑ‡ÐµÑ‚Ðµ Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ðµ
- ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸ (ÐµÑÐ»Ð¸ ÐµÑÑ‚ÑŒ)
- Ð’Ñ‹Ð±Ð¾Ñ€ ÑÐ¿Ð¾ÑÐ¾Ð±Ð° Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹

---

### 5.4. Ð›Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ°Ð±Ð¸Ð½ÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° (Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ð°)

**ÐœÐ°ÐºÐµÑ‚:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ÐœÐ¾Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Ð¢Ð°Ð½Ñ†Ñ‹ â€º ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ðµ 5-7 Ð»ÐµÑ‚                              â”‚ â”‚
â”‚ â”‚ Ð”ÐµÐ¹ÑÑ‚Ð²ÑƒÐµÑ‚ Ð´Ð¾: 30.11.2024                                â”‚ â”‚
â”‚ â”‚ Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: âš ï¸ Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ                          â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ Ðš Ð¾Ð¿Ð»Ð°Ñ‚Ðµ: 4200 Ñ€ÑƒÐ±.                                     â”‚ â”‚
â”‚ â”‚ ÐžÐ¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ Ð´Ð¾: 30.11.2024                                 â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ [ÐžÐ¿Ð»Ð°Ñ‚Ð¸Ñ‚ÑŒ Ð¾Ð½Ð»Ð°Ð¹Ð½]                                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Ð’Ð¾ÐºÐ°Ð» â€º Ð˜Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð·Ð°Ð½ÑÑ‚Ð¸Ñ                          â”‚ â”‚
â”‚ â”‚ Ð”ÐµÐ¹ÑÑ‚Ð²ÑƒÐµÑ‚ Ð´Ð¾: 14.12.2024                                â”‚ â”‚
â”‚ â”‚ Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: âœ… ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ð¹                                     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»:**
- ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ†Ð¸Ñ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ñ
- ÐšÐ½Ð¾Ð¿ÐºÐ° Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ (Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´ Ð½Ð° Ð®ÐšÐ°ÑÑÐ°)

---

### 5.5. Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹

**ÐœÐ°ÐºÐµÑ‚:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹: Ð˜Ð²Ð°Ð½Ð¾Ð² Ð˜Ð²Ð°Ð½ Ð˜Ð²Ð°Ð½Ð¾Ð²Ð¸Ñ‡                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹: [Ð’ÑÐµ ÑÐ¿Ð¾ÑÐ¾Ð±Ñ‹ â–¼] [Ð’ÑÐµ ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ â–¼] [Ð—Ð° Ð³Ð¾Ð´ â–¼]        â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 13.11.2024, 10:35                                       â”‚ â”‚
â”‚ â”‚ ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°: Ð¢Ð°Ð½Ñ†Ñ‹ â€º ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ðµ 5-7 Ð»ÐµÑ‚          â”‚ â”‚
â”‚ â”‚ Ð¡ÑƒÐ¼Ð¼Ð°: 4500 Ñ€ÑƒÐ±.                                        â”‚ â”‚
â”‚ â”‚ Ð¡Ð¿Ð¾ÑÐ¾Ð±: ÐžÐ½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ð° (Ð®ÐšÐ°ÑÑÐ°)                         â”‚ â”‚
â”‚ â”‚ Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: âœ… ÐžÐ¿Ð»Ð°Ñ‡ÐµÐ½Ð¾                                     â”‚ â”‚
â”‚ â”‚ [Ð§ÐµÐº]                                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 15.10.2024, 14:20                                       â”‚ â”‚
â”‚ â”‚ ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°: Ð¢Ð°Ð½Ñ†Ñ‹ â€º ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ðµ 5-7 Ð»ÐµÑ‚          â”‚ â”‚
â”‚ â”‚ Ð¡ÑƒÐ¼Ð¼Ð°: 4500 Ñ€ÑƒÐ±.                                        â”‚ â”‚
â”‚ â”‚ Ð¡Ð¿Ð¾ÑÐ¾Ð±: Ð‘Ð°Ð½ÐºÐ¾Ð²ÑÐºÐ°Ñ ÐºÐ°Ñ€Ñ‚Ð° (Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»)                    â”‚ â”‚
â”‚ â”‚ Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: âœ… ÐžÐ¿Ð»Ð°Ñ‡ÐµÐ½Ð¾                                     â”‚ â”‚
â”‚ â”‚ [Ð§ÐµÐº]                                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 10.09.2024, 16:45                                       â”‚ â”‚
â”‚ â”‚ Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚: ÐžÑ‚Ð¼ÐµÐ½Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð’Ð¾ÐºÐ°Ð»                        â”‚ â”‚
â”‚ â”‚ Ð¡ÑƒÐ¼Ð¼Ð°: 2000 Ñ€ÑƒÐ±.                                        â”‚ â”‚
â”‚ â”‚ Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: âœ… Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰ÐµÐ½Ð¾                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»:**
- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð²ÑÐµÑ… Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ Ð¸ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð¾Ð²
- Ð¤Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð¿Ð¾ ÑÐ¿Ð¾ÑÐ¾Ð±Ñƒ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹, ÑÑ‚Ð°Ñ‚ÑƒÑÑƒ, Ð¿ÐµÑ€Ð¸Ð¾Ð´Ñƒ
- Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚ÑŒ ÑÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Ñ‡ÐµÐº

---

### 5.6. Ð¤Ð¾Ñ€Ð¼Ð° Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°

**ÐœÐ°ÐºÐµÑ‚:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ÐžÑ‚Ð¼ÐµÐ½Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ Ð’Ñ‹ ÑƒÐ²ÐµÑ€ÐµÐ½Ñ‹, Ñ‡Ñ‚Ð¾ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð¾Ñ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚?                  â”‚
â”‚                                                               â”‚
â”‚ ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚: Ð¢Ð°Ð½Ñ†Ñ‹ â€º ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ðµ 5-7 Ð»ÐµÑ‚                       â”‚
â”‚ ÐšÐ»Ð¸ÐµÐ½Ñ‚: Ð˜Ð²Ð°Ð½Ð¾Ð² Ð˜Ð²Ð°Ð½ Ð˜Ð²Ð°Ð½Ð¾Ð²Ð¸Ñ‡                                â”‚
â”‚                                                               â”‚
â”‚ ÐŸÐµÑ€Ð¸Ð¾Ð´ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ:      01.11.2024 - 30.11.2024               â”‚
â”‚ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¾ Ð·Ð°Ð½ÑÑ‚Ð¸Ð¹: 8 Ð¸Ð· 12                                â”‚
â”‚ ÐžÑÑ‚Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð½ÑÑ‚Ð¸Ð¹:     4                                      â”‚
â”‚                                                               â”‚
â”‚ ÐžÐ¿Ð»Ð°Ñ‡ÐµÐ½Ð¾:             4500 Ñ€ÑƒÐ±.                              â”‚
â”‚ Ðš Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ñƒ:           1500 Ñ€ÑƒÐ±. (Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)            â”‚
â”‚                                                               â”‚
â”‚ ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð° Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹:                                              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ÐŸÐ¾ Ð¶ÐµÐ»Ð°Ð½Ð¸ÑŽ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°                                    â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚ [ÐžÑ‚Ð¼ÐµÐ½Ð°]                                   [ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚] â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»:**
- Ð Ð°ÑÑ‡ÐµÑ‚ ÑÑƒÐ¼Ð¼Ñ‹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð° (Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹)
- ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¸Ñ‡Ð¸Ð½Ð° Ð¾Ñ‚Ð¼ÐµÐ½Ñ‹
- ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ

---

## 6. API ÑÐ½Ð´Ð¿Ð¾Ð¸Ð½Ñ‚Ñ‹

### 6.1. Ð¢Ð¸Ð¿Ñ‹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² (SubscriptionTypes)

#### `GET /api/subscription-types`

ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ñ‚Ð¸Ð¿Ð¾Ð² Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð².

**Query Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `groupId` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð³Ñ€ÑƒÐ¿Ð¿Ðµ

**Response 200:**
```json
{
  "subscriptionTypes": [
    {
      "id": "uuid",
      "groupId": "uuid",
      "name": "ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð½Ð° 1 Ð¼ÐµÑÑÑ†",
      "duration": 30,
      "price": 5000.00,
      "isFree": false,
      "group": {
        "id": "uuid",
        "name": "ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ðµ 5-7 Ð»ÐµÑ‚",
        "studio": {
          "id": "uuid",
          "name": "Ð¢Ð°Ð½Ñ†Ñ‹"
        }
      }
    }
  ]
}
```

---

#### `POST /api/subscription-types`

Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ Ñ‚Ð¸Ð¿ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°.

**Request Body:**
```json
{
  "groupId": "uuid",
  "name": "ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð½Ð° 1 Ð¼ÐµÑÑÑ†",
  "duration": 30,
  "price": 5000.00,
  "isFree": false
}
```

**Response 201:** Ð¡Ð¾Ð·Ð´Ð°Ð½Ð½Ñ‹Ð¹ Ñ‚Ð¸Ð¿ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°

---

### 6.2. ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ (Subscriptions)

#### `GET /api/subscriptions`

ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð².

**Query Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `clientId` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
- `groupId` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð³Ñ€ÑƒÐ¿Ð¿Ðµ
- `status` (optional): `PENDING` | `ACTIVE` | `EXPIRED` | `CANCELLED`

**Response 200:**
```json
{
  "subscriptions": [
    {
      "id": "uuid",
      "subscriptionTypeId": "uuid",
      "clientId": "uuid",
      "groupId": "uuid",
      "startDate": "2024-11-01",
      "endDate": "2024-11-30",
      "basePrice": 5000.00,
      "discountPercentage": 10.00,
      "finalPrice": 4500.00,
      "compensationAmount": 300.00,
      "status": "ACTIVE",
      "client": {
        "id": "uuid",
        "lastName": "Ð˜Ð²Ð°Ð½Ð¾Ð²",
        "firstName": "Ð˜Ð²Ð°Ð½",
        "middleName": "Ð˜Ð²Ð°Ð½Ð¾Ð²Ð¸Ñ‡"
      },
      "group": {
        "id": "uuid",
        "name": "ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ðµ 5-7 Ð»ÐµÑ‚",
        "studio": {
          "id": "uuid",
          "name": "Ð¢Ð°Ð½Ñ†Ñ‹"
        }
      },
      "subscriptionType": {
        "id": "uuid",
        "name": "ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð½Ð° 1 Ð¼ÐµÑÑÑ†",
        "duration": 30
      },
      "createdAt": "2024-11-01T10:00:00Z",
      "updatedAt": "2024-11-13T10:00:00Z"
    }
  ]
}
```

---

#### `POST /api/subscriptions`

Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ (Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ).

**Request Body:**
```json
{
  "subscriptionTypeId": "uuid",
  "clientId": "uuid",
  "groupId": "uuid",
  "paymentMethod": "CASH"
}
```

**Response 201:**
```json
{
  "subscription": { ... },
  "invoice": { ... }
}
```

---

#### `PATCH /api/subscriptions/:id`

ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚.

**Request Body:**
```json
{
  "status": "CANCELLED"
}
```

**Response 200:** ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚

---

#### `POST /api/subscriptions/:id/cancel`

ÐžÑ‚Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð¸ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚.

**Request Body:**
```json
{
  "reason": "ÐŸÐ¾ Ð¶ÐµÐ»Ð°Ð½Ð¸ÑŽ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°"
}
```

**Response 200:**
```json
{
  "subscription": { ... },
  "refund": {
    "id": "uuid",
    "amount": 1500.00,
    "reason": "ÐŸÐ¾ Ð¶ÐµÐ»Ð°Ð½Ð¸ÑŽ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°",
    "status": "PENDING"
  }
}
```

---

### 6.3. Ð¡Ñ‡ÐµÑ‚Ð° (Invoices)

#### `GET /api/invoices`

ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº ÑÑ‡ÐµÑ‚Ð¾Ð².

**Query Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `clientId` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
- `subscriptionId` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñƒ
- `status` (optional): `PENDING` | `PAID` | `OVERDUE` | `CANCELLED`

**Response 200:**
```json
{
  "invoices": [
    {
      "id": "uuid",
      "subscriptionId": "uuid",
      "clientId": "uuid",
      "amount": 4200.00,
      "status": "PENDING",
      "issuedAt": "2024-11-06T10:00:00Z",
      "dueDate": "2024-11-30",
      "paidAt": null,
      "subscription": { ... },
      "client": { ... }
    }
  ]
}
```

---

#### `GET /api/invoices/:id`

ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ ÑÑ‡ÐµÑ‚.

**Response 200:**
```json
{
  "id": "uuid",
  "subscriptionId": "uuid",
  "clientId": "uuid",
  "amount": 4200.00,
  "status": "PENDING",
  "issuedAt": "2024-11-06T10:00:00Z",
  "dueDate": "2024-11-30",
  "paidAt": null,
  "subscription": {
    "id": "uuid",
    "group": {
      "name": "ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ðµ 5-7 Ð»ÐµÑ‚",
      "studio": { "name": "Ð¢Ð°Ð½Ñ†Ñ‹" }
    }
  },
  "client": {
    "id": "uuid",
    "lastName": "Ð˜Ð²Ð°Ð½Ð¾Ð²",
    "firstName": "Ð˜Ð²Ð°Ð½",
    "middleName": "Ð˜Ð²Ð°Ð½Ð¾Ð²Ð¸Ñ‡",
    "email": "ivanov@example.com",
    "phone": "+79001234567"
  }
}
```

---

### 6.4. ÐŸÐ»Ð°Ñ‚ÐµÐ¶Ð¸ (Payments)

#### `GET /api/payments`

ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹.

**Query Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `clientId` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
- `paymentMethod` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÑÐ¿Ð¾ÑÐ¾Ð±Ñƒ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
- `status` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÑÑ‚Ð°Ñ‚ÑƒÑÑƒ
- `dateFrom` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ñ Ð´Ð°Ñ‚Ñ‹
- `dateTo` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð´Ð¾ Ð´Ð°Ñ‚Ñ‹

**Response 200:**
```json
{
  "payments": [
    {
      "id": "uuid",
      "invoiceId": "uuid",
      "clientId": "uuid",
      "amount": 4500.00,
      "paymentMethod": "ONLINE",
      "status": "COMPLETED",
      "transactionId": "yukassa-123456",
      "paidAt": "2024-11-13T10:35:00Z",
      "invoice": {
        "subscription": {
          "group": {
            "name": "ÐÐ°Ñ‡Ð¸Ð½Ð°ÑŽÑ‰Ð¸Ðµ 5-7 Ð»ÐµÑ‚",
            "studio": { "name": "Ð¢Ð°Ð½Ñ†Ñ‹" }
          }
        }
      },
      "client": { ... }
    }
  ]
}
```

---

#### `POST /api/payments`

Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ (Ð¾Ð¿Ð»Ð°Ñ‚Ð° ÑÑ‡ÐµÑ‚Ð°).

**Request Body (Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ/Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð»):**
```json
{
  "invoiceId": "uuid",
  "paymentMethod": "CASH"
}
```

**Response 201:**
```json
{
  "id": "uuid",
  "invoiceId": "uuid",
  "clientId": "uuid",
  "amount": 4500.00,
  "paymentMethod": "CASH",
  "status": "COMPLETED",
  "paidAt": "2024-11-13T10:00:00Z"
}
```

**Request Body (Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ð°):**
```json
{
  "invoiceId": "uuid",
  "paymentMethod": "ONLINE"
}
```

**Response 201:**
```json
{
  "id": "uuid",
  "invoiceId": "uuid",
  "clientId": "uuid",
  "amount": 4500.00,
  "paymentMethod": "ONLINE",
  "status": "PENDING",
  "paymentUrl": "https://yookassa.ru/checkout/..."
}
```

---

#### `POST /api/payments/webhook/yukassa`

Webhook Ð´Ð»Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹ Ð¾Ñ‚ Ð®ÐšÐ°ÑÑÐ°.

**Request Body (Ð¾Ñ‚ Ð®ÐšÐ°ÑÑÐ°):**
```json
{
  "type": "notification",
  "event": "payment.succeeded",
  "object": {
    "id": "yukassa-123456",
    "status": "succeeded",
    "amount": {
      "value": "4500.00",
      "currency": "RUB"
    },
    "metadata": {
      "paymentId": "uuid",
      "invoiceId": "uuid"
    }
  }
}
```

**Response 200:** OK

**ÐŸÑ€Ð¾Ñ†ÐµÑÑ:**
1. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð¿Ð¾Ð´Ð¿Ð¸ÑÑŒ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
2. ÐÐ°Ñ…Ð¾Ð´Ð¸Ñ‚ Payment Ð¿Ð¾ metadata.paymentId
3. ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ ÑÑ‚Ð°Ñ‚ÑƒÑ Payment: PENDING â†’ COMPLETED
4. ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ Invoice: PENDING â†’ PAID
5. ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÑ‚ Subscription: PENDING â†’ ACTIVE Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ²Ð°ÐµÑ‚
6. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ

---

### 6.5. Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ñ‹ (Refunds)

#### `GET /api/refunds`

ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð¾Ð².

**Query Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `clientId` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
- `status` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÑÑ‚Ð°Ñ‚ÑƒÑÑƒ

**Response 200:**
```json
{
  "refunds": [
    {
      "id": "uuid",
      "paymentId": "uuid",
      "clientId": "uuid",
      "amount": 1500.00,
      "reason": "ÐžÑ‚Ð¼ÐµÐ½Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð¿Ð¾ Ð¶ÐµÐ»Ð°Ð½Ð¸ÑŽ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°",
      "status": "COMPLETED",
      "refundedAt": "2024-11-13T15:00:00Z",
      "payment": { ... },
      "client": { ... }
    }
  ]
}
```

---

#### `PATCH /api/refunds/:id`

ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð° (Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ).

**Request Body:**
```json
{
  "status": "COMPLETED"
}
```

**Response 200:** ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚

---

### 6.6. ÐšÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸ (Compensations)

#### `GET /api/compensations`

ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¹.

**Query Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `clientId` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
- `subscriptionId` (optional): Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñƒ

**Response 200:**
```json
{
  "compensations": [
    {
      "id": "uuid",
      "clientId": "uuid",
      "subscriptionId": "uuid",
      "attendanceId": "uuid",
      "amount": 375.00,
      "reason": "ÐŸÑ€Ð¾Ð¿ÑƒÑÐº Ð¿Ð¾ Ð±Ð¾Ð»ÐµÐ·Ð½Ð¸: 2024-11-10",
      "appliedAt": null,
      "attendance": {
        "schedule": {
          "date": "2024-11-10",
          "startTime": "16:00:00"
        }
      }
    }
  ]
}
```

---

## 7. Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¸

### 7.1. Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¼ CRM

**Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ:**
- ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð² (Client)
- ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð»ÑŒÐ³Ð¾Ñ‚Ð½Ñ‹Ñ… ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¹ (BenefitCategory) Ðº ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°

**Ð¡Ð²ÑÐ·Ð¸:**
- `Subscription.clientId` â†’ `Client.id`
- `Invoice.clientId` â†’ `Client.id`
- `Payment.clientId` â†’ `Client.id`

---

### 7.2. Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¼ Ð¡Ñ‚ÑƒÐ´Ð¸Ð¹

**Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ:**
- ÐŸÑ€Ð¸Ð²ÑÐ·ÐºÐ° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ðº Ð³Ñ€ÑƒÐ¿Ð¿Ð°Ð¼
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ñ‚Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ð¿Ñ€Ð¸ Ð¸ÑÑ‚ÐµÑ‡ÐµÐ½Ð¸Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
- Ð£Ñ‡ÐµÑ‚ Ð¿Ð¾ÑÐµÑ‰Ð°ÐµÐ¼Ð¾ÑÑ‚Ð¸ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸

**Ð¡Ð²ÑÐ·Ð¸:**
- `Subscription.groupId` â†’ `Group.id`
- `SubscriptionType.groupId` â†’ `Group.id`
- `Compensation.attendanceId` â†’ `Attendance.id`

**ÐŸÑ€Ð¾Ñ†ÐµÑÑ:**
1. ÐŸÑ€Ð¸ Ð¸ÑÑ‚ÐµÑ‡ÐµÐ½Ð¸Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ > 14 Ð´Ð½ÐµÐ¹:
   - Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ñ‚Ñ‡Ð¸ÑÐ»ÑÐµÑ‚ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° Ð¸Ð· Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹ (GroupMember.status = EXPELLED)
2. ÐŸÑ€Ð¸ Ð¾Ñ‚Ð¼ÐµÑ‚ÐºÐµ Ð¿Ð¾ÑÐµÑ‰Ð°ÐµÐ¼Ð¾ÑÑ‚Ð¸ ÐºÐ°Ðº SICK/EXCUSED:
   - Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ Compensation Ð¸ ÑƒÐ²ÐµÐ»Ð¸Ñ‡Ð¸Ð²Ð°ÐµÑ‚ Subscription.compensationAmount

---

### 7.3. Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¼ Ð Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ñ

**Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ:**
- Ð Ð°ÑÑ‡ÐµÑ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð·Ð°Ð½ÑÑ‚Ð¸Ñ Ð´Ð»Ñ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸
- ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð° Ð·Ð°Ð½ÑÑ‚Ð¸Ð¹ Ð² Ð¼ÐµÑÑÑ†Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð°

**ÐŸÑ€Ð¾Ñ†ÐµÑÑ:**
```typescript
// Ð Ð°ÑÑ‡ÐµÑ‚ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚Ð¸ 1 Ð·Ð°Ð½ÑÑ‚Ð¸Ñ
const schedulesCount = await countGroupSchedulesInMonth(groupId, subscription.startDate);
const lessonPrice = subscription.finalPrice / schedulesCount;
```

---

### 7.4. Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð½Ð¾Ð¹ ÑÐ¸ÑÑ‚ÐµÐ¼Ð¾Ð¹ Ð®ÐšÐ°ÑÑÐ°

**Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ:**
- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ Ð´Ð»Ñ Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
- ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° webhook-ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹
- Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ ÑÑ€ÐµÐ´ÑÑ‚Ð² Ñ‡ÐµÑ€ÐµÐ· API

**ÐŸÑ€Ð¾Ñ†ÐµÑÑ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°:**
```typescript
import { YooCheckout } from '@a2seven/yoo-checkout';

const checkout = new YooCheckout({
  shopId: process.env.YUKASSA_SHOP_ID,
  secretKey: process.env.YUKASSA_SECRET_KEY,
});

const payment = await checkout.createPayment({
  amount: {
    value: invoice.amount.toFixed(2),
    currency: 'RUB',
  },
  confirmation: {
    type: 'redirect',
    return_url: `${BASE_URL}/payments/${paymentId}/success`,
  },
  capture: true,
  description: `ÐžÐ¿Ð»Ð°Ñ‚Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°: ${group.studio.name} â€º ${group.name}`,
  metadata: {
    paymentId: paymentId,
    invoiceId: invoice.id,
    clientId: client.id,
  },
});

return payment.confirmation.confirmation_url; // URL Ð´Ð»Ñ Ñ€ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚Ð° ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
```

**ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ webhook:**
```typescript
app.post('/api/payments/webhook/yukassa', async (req, res) => {
  const notification = req.body;

  // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð½Ð¾ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)
  // ...

  if (notification.event === 'payment.succeeded') {
    const { paymentId, invoiceId } = notification.object.metadata;

    // ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°
    await updatePayment(paymentId, {
      status: 'COMPLETED',
      transactionId: notification.object.id,
      paidAt: new Date(),
    });

    // ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ ÑÑ‡ÐµÑ‚
    await updateInvoice(invoiceId, { status: 'PAID', paidAt: new Date() });

    // ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾Ð´Ð»Ð¸Ñ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚
    const invoice = await getInvoice(invoiceId);
    const subscription = invoice.subscription;

    if (subscription.status === 'PENDING') {
      // ÐÐ¾Ð²Ñ‹Ð¹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚
      await updateSubscription(subscription.id, { status: 'ACTIVE' });
    } else if (subscription.status === 'ACTIVE' || subscription.status === 'EXPIRED') {
      // ÐŸÑ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ
      await renewSubscription(subscription.id);
    }

    // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
    await sendNotification(invoice.clientId, { type: 'PAYMENT_SUCCESS' });
  }

  res.status(200).send('OK');
});
```

**ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð°:**
```typescript
const refund = await checkout.createRefund({
  payment_id: payment.transactionId,
  amount: {
    value: refundAmount.toFixed(2),
    currency: 'RUB',
  },
});

await updateRefund(refundId, {
  status: 'COMPLETED',
  refundedAt: new Date(),
});

await updatePayment(payment.id, { status: 'REFUNDED' });
```

---

### 7.5. Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¼ Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹

**Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ:**
- Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð² Ð¾ Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ð¸ ÑÑ‡ÐµÑ‚Ð° Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ
- ÐÐ°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¾Ð± Ð¾Ð¿Ð»Ð°Ñ‚Ðµ
- Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¸ÑÑ‚ÐµÑ‡ÐµÐ½Ð¸Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
- ÐŸÐ¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹

**Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ñ:**
- `SUBSCRIPTION_RENEWAL_DUE` â€” Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½ ÑÑ‡ÐµÑ‚ Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ (Ð·Ð° 7 Ð´Ð½ÐµÐ¹)
- `PAYMENT_REMINDER` â€” Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ðµ Ð¾Ð± Ð¾Ð¿Ð»Ð°Ñ‚Ðµ (Ð·Ð° 2-3 Ð´Ð½Ñ Ð´Ð¾ dueDate)
- `SUBSCRIPTION_EXPIRED_WARNING` â€” Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð¸ÑÑ‚ÐµÐº, Ð½Ðµ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½
- `PAYMENT_SUCCESS` â€” ÑƒÑÐ¿ÐµÑˆÐ½Ð°Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ð°
- `SUBSCRIPTION_CANCELLED` â€” Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚ Ð¾Ñ‚Ð¼ÐµÐ½ÐµÐ½

---

### 7.6. Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð¼Ð¾Ð´ÑƒÐ»ÐµÐ¼ Ð Ð°ÑÑ‡ÐµÑ‚Ð° Ð—ÐŸ

**Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ:**
- Ð£Ñ‡ÐµÑ‚ Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð½Ñ‹Ñ… Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð´Ð»Ñ Ñ€Ð°ÑÑ‡ÐµÑ‚Ð° Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐ¸ ÑÑ‚ÑƒÐ´Ð¸Ð¸
- Ð Ð°ÑÑ‡ÐµÑ‚ Ð—ÐŸ Ð¿Ñ€ÐµÐ¿Ð¾Ð´Ð°Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ (Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚ Ð¾Ñ‚ Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐ¸)

**Ð”Ð°Ð½Ð½Ñ‹Ðµ:**
- Ð¡ÑƒÐ¼Ð¼Ð° Ð²ÑÐµÑ… Ð¾Ð¿Ð»Ð°Ñ‡ÐµÐ½Ð½Ñ‹Ñ… Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² ÑÑ‚ÑƒÐ´Ð¸Ð¸ Ð·Ð° Ð¼ÐµÑÑÑ†
- Ð£Ñ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÑŽÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Payments ÑÐ¾ ÑÑ‚Ð°Ñ‚ÑƒÑÐ¾Ð¼ COMPLETED

---

## 8. ÐŸÑ€Ð°Ð²Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°

### 8.1. ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€

**ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð´Ð¾ÑÑ‚ÑƒÐ¿:**
- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ, Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð¾Ð² Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- ÐžÑ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ (Ð²ÑÐµ ÑÐ¿Ð¾ÑÐ¾Ð±Ñ‹)
- Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð¾Ð²
- ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð²ÑÐµÑ… Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ñ‹Ñ… Ð¾Ñ‚Ñ‡ÐµÑ‚Ð¾Ð²

---

### 8.2. ÐœÐµÐ½ÐµÐ´Ð¶ÐµÑ€/Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€

**Ð”Ð¾ÑÑ‚ÑƒÐ¿:**
- ÐžÑ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð´Ð»Ñ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²
- ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ (Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ, Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð°Ð», ÐºÐ²Ð¸Ñ‚Ð°Ð½Ñ†Ð¸Ñ)
- ÐžÑ‚Ð¼ÐµÐ½Ð° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ñ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð¾Ð¼
- ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²
- Ð’Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‡ÐµÑ‚Ð¾Ð² Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ (Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ)

**ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ:**
- ÐÐµ Ð¼Ð¾Ð¶ÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ñ‚ÑŒ/Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ð¸Ð¿Ñ‹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- ÐÐµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿Ñ€Ð¾ÑÐ¼Ð°Ñ‚Ñ€Ð¸Ð²Ð°Ñ‚ÑŒ Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ñ‹Ðµ Ð¾Ñ‚Ñ‡ÐµÑ‚Ñ‹ Ð²ÑÐµÐ³Ð¾ Ñ†ÐµÐ½Ñ‚Ñ€Ð°

---

### 8.3. ÐšÐ»Ð¸ÐµÐ½Ñ‚

**Ð”Ð¾ÑÑ‚ÑƒÐ¿ (Ð»Ð¸Ñ‡Ð½Ñ‹Ð¹ ÐºÐ°Ð±Ð¸Ð½ÐµÑ‚):**
- ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ ÑÐ²Ð¾Ð¸Ñ… Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- ÐžÐ½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ð° ÑÑ‡ÐµÑ‚Ð¾Ð² Ñ‡ÐµÑ€ÐµÐ· Ð®ÐšÐ°ÑÑÐ°
- ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ð¸ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹
- Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ Ñ‡ÐµÐºÐ¾Ð²

**ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ:**
- ÐÐµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¾Ñ‚Ð¼ÐµÐ½ÑÑ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ ÑÐ°Ð¼Ð¾ÑÑ‚Ð¾ÑÑ‚ÐµÐ»ÑŒÐ½Ð¾ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‡ÐµÑ€ÐµÐ· Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ð°)
- ÐÐµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ð¸Ð´ÐµÑ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ Ð´Ñ€ÑƒÐ³Ð¸Ñ… ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð¾Ð²

---

## 9. Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸

### 9.1. ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‡ÐµÐºÐ¾Ð²

ÐŸÐ¾ÑÐ»Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð¹ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ñ‡ÐµÐº Ð² Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ðµ PDF.

**Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ Ñ‡ÐµÐºÐ°:**
- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¸ Ñ€ÐµÐºÐ²Ð¸Ð·Ð¸Ñ‚Ñ‹
- Ð”Ð°Ñ‚Ð° Ð¸ Ð²Ñ€ÐµÐ¼Ñ Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
- Ð¤Ð˜Ðž ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
- ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° (Ð³Ñ€ÑƒÐ¿Ð¿Ð°)
- Ð¡ÑƒÐ¼Ð¼Ð° Ð¿Ð»Ð°Ñ‚ÐµÐ¶Ð°
- Ð¡Ð¿Ð¾ÑÐ¾Ð± Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
- QR-ÐºÐ¾Ð´ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸

---

### 9.2. Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚ Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…

**Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ñ‹:**
- Excel (.xlsx)
- CSV (.csv)
- PDF (Ð´Ð»Ñ Ð¾Ñ‚Ñ‡ÐµÑ‚Ð¾Ð²)

**Ð­ÐºÑÐ¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:**
- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð²ÑÐµÑ… Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹ Ð·Ð° Ð¿ÐµÑ€Ð¸Ð¾Ð´
- Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚Ð¾Ð²
- ÐžÑ‚Ñ‡ÐµÑ‚ Ð¿Ð¾ Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐµ ÑÑ‚ÑƒÐ´Ð¸Ð¹
- ÐžÑ‚Ñ‡ÐµÑ‚ Ð¿Ð¾ Ð·Ð°Ð´Ð¾Ð»Ð¶ÐµÐ½Ð½Ð¾ÑÑ‚ÑÐ¼

---

### 9.3. Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸ Ð°Ð½Ð°Ð»Ð¸Ñ‚Ð¸ÐºÐ°

**Ð”Ð°ÑˆÐ±Ð¾Ñ€Ð´ Ð´Ð»Ñ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°:**
- ÐžÐ±Ñ‰Ð°Ñ Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐ° Ð·Ð° Ð¼ÐµÑÑÑ†
- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð°ÐºÑ‚Ð¸Ð²Ð½Ñ‹Ñ… Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿Ñ€Ð¾ÑÑ€Ð¾Ñ‡ÐµÐ½Ð½Ñ‹Ñ… ÑÑ‡ÐµÑ‚Ð¾Ð²
- Ð¢Ð¾Ð¿-5 ÑÐ°Ð¼Ñ‹Ñ… Ð¿Ð¾Ð¿ÑƒÐ»ÑÑ€Ð½Ñ‹Ñ… Ð³Ñ€ÑƒÐ¿Ð¿ (Ð¿Ð¾ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ñƒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð²)
- Ð“Ñ€Ð°Ñ„Ð¸Ðº Ð²Ñ‹Ñ€ÑƒÑ‡ÐºÐ¸ Ð¿Ð¾ Ð¼ÐµÑÑÑ†Ð°Ð¼
- Ð¡Ñ€ÐµÐ´Ð½Ð¸Ð¹ Ñ‡ÐµÐº

---

## 10. Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð´ÐµÑ‚Ð°Ð»Ð¸

### 10.1. Ð˜Ð½Ð´ÐµÐºÑÑ‹ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…

**ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸:**

```sql
-- Ð”Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ° Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð¿Ð¾ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
CREATE INDEX idx_subscriptions_client_id ON subscriptions(client_id);
CREATE INDEX idx_subscriptions_group_id ON subscriptions(group_id);
CREATE INDEX idx_subscriptions_status ON subscriptions(status);
CREATE INDEX idx_subscriptions_end_date ON subscriptions(end_date);

-- Ð”Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ° ÑÑ‡ÐµÑ‚Ð¾Ð²
CREATE INDEX idx_invoices_subscription_id ON invoices(subscription_id);
CREATE INDEX idx_invoices_client_id ON invoices(client_id);
CREATE INDEX idx_invoices_status ON invoices(status);
CREATE INDEX idx_invoices_due_date ON invoices(due_date);

-- Ð”Ð»Ñ Ð±Ñ‹ÑÑ‚Ñ€Ð¾Ð³Ð¾ Ð¿Ð¾Ð¸ÑÐºÐ° Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹
CREATE INDEX idx_payments_client_id ON payments(client_id);
CREATE INDEX idx_payments_status ON payments(status);
```

---

### 10.2. Ð¤Ð¾Ð½Ð¾Ð²Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ (Cron Jobs)

**Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸ (00:00):**
- `processSubscriptionRenewals()` â€” Ð²Ñ‹ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‡ÐµÑ‚Ð¾Ð² Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ (Ð·Ð° 7 Ð´Ð½ÐµÐ¹)
- `sendPaymentReminders()` â€” Ð½Ð°Ð¿Ð¾Ð¼Ð¸Ð½Ð°Ð½Ð¸Ñ Ð¾Ð± Ð¾Ð¿Ð»Ð°Ñ‚Ðµ (Ð·Ð° 2-3 Ð´Ð½Ñ)
- `notifyExpiredSubscriptions()` â€” ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¾Ð± Ð¸ÑÑ‚ÐµÑ‡ÐµÐ½Ð¸Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
- `processOverdueSubscriptions()` â€” Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ñ‚Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ðµ Ð·Ð° Ð½ÐµÑƒÐ¿Ð»Ð°Ñ‚Ñƒ (14+ Ð´Ð½ÐµÐ¹)

**Ð•Ð¶ÐµÑ‡Ð°ÑÐ½Ñ‹Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸:**
- `updateOverdueInvoices()` â€” Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ‚ÑƒÑÐ° ÑÑ‡ÐµÑ‚Ð¾Ð² (PENDING â†’ OVERDUE)

---

### 10.3. ÐšÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

**ÐšÑÑˆÐ¸Ñ€ÑƒÐµÐ¼Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:**
- Ð¢Ð¸Ð¿Ñ‹ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð¿Ð¾ Ð³Ñ€ÑƒÐ¿Ð¿Ð°Ð¼ (TTL = 1 Ñ‡Ð°Ñ)
- ÐÐºÑ‚Ð¸Ð²Ð½Ñ‹Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð° (TTL = 5 Ð¼Ð¸Ð½ÑƒÑ‚)

**Ð˜Ð½Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ ÐºÑÑˆÐ°:**
- ÐŸÑ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸/Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¸ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°
- ÐŸÑ€Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ðµ ÑÑ‡ÐµÑ‚Ð°

---

### 10.4. Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ

**Ð—Ð°Ñ‰Ð¸Ñ‚Ð° webhook:**
```typescript
// ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ð¾Ñ‚ Ð®ÐšÐ°ÑÑÐ°
function verifyYukassaSignature(req: Request): boolean {
  const signature = req.headers['x-signature'];
  const body = JSON.stringify(req.body);

  const expectedSignature = crypto
    .createHmac('sha256', process.env.YUKASSA_SECRET_KEY)
    .update(body)
    .digest('hex');

  return signature === expectedSignature;
}

app.post('/api/payments/webhook/yukassa', (req, res) => {
  if (!verifyYukassaSignature(req)) {
    return res.status(401).send('Invalid signature');
  }

  // ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° webhook...
});
```

---

## 11. ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ

### 11.1. ÐžÑ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°

```typescript
// 1. ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð·Ð°Ð¿Ð¸ÑÐ°Ð½ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ñƒ (ÑÐ¼. Ð¼Ð¾Ð´ÑƒÐ»ÑŒ Ð¡Ñ‚ÑƒÐ´Ð¸Ð¹)
const groupMember = await createGroupMember({
  groupId: 'group-uuid',
  clientId: 'client-uuid',
  status: 'ACTIVE',
});

// 2. ÐÐ°Ð¹Ñ‚Ð¸ Ñ‚Ð¸Ð¿ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð° Ð´Ð»Ñ Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹
const subscriptionType = await findSubscriptionTypeByGroup('group-uuid');

// 3. ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð»ÑŒÐ³Ð¾Ñ‚Ð½ÑƒÑŽ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑŽ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ð°
const client = await getClient('client-uuid');
const discountPercentage = client.benefitCategory?.discountPercentage || 0;

// 4. Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ
const basePrice = subscriptionType.price;
const finalPrice = basePrice * (1 - discountPercentage / 100);

// 5. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚
const subscription = await createSubscription({
  subscriptionTypeId: subscriptionType.id,
  clientId: client.id,
  groupId: 'group-uuid',
  startDate: new Date(),
  endDate: addDays(new Date(), subscriptionType.duration),
  basePrice,
  discountPercentage,
  finalPrice,
  status: 'PENDING',
});

// 6. Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÑ‡ÐµÑ‚
const invoice = await createInvoice({
  subscriptionId: subscription.id,
  clientId: client.id,
  amount: finalPrice,
  dueDate: subscription.endDate,
  status: 'PENDING',
});

// 7. ÐšÐ»Ð¸ÐµÐ½Ñ‚ Ð¾Ð¿Ð»Ð°Ñ‡Ð¸Ð²Ð°ÐµÑ‚ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, Ð½Ð°Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸)
const payment = await createPayment({
  invoiceId: invoice.id,
  clientId: client.id,
  amount: finalPrice,
  paymentMethod: 'CASH',
  status: 'COMPLETED',
  paidAt: new Date(),
});

// 8. ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚
await updateInvoice(invoice.id, { status: 'PAID', paidAt: new Date() });
await updateSubscription(subscription.id, { status: 'ACTIVE' });

// 9. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð¶Ð´ÐµÐ½Ð¸Ðµ
await sendNotification(client.id, {
  type: 'PAYMENT_SUCCESS',
  data: { groupName: group.name, amount: finalPrice },
});
```

---

### 11.2. ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°

```typescript
// Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ð°Ñ Ñ„Ð¾Ð½Ð¾Ð²Ð°Ñ Ð·Ð°Ð´Ð°Ñ‡Ð°
async function processSubscriptionRenewals() {
  const subscriptionsToRenew = await prisma.subscription.findMany({
    where: {
      endDate: {
        gte: addDays(new Date(), 7),
        lte: addDays(new Date(), 7),
      },
      status: 'ACTIVE',
    },
    include: {
      client: { include: { benefitCategory: true } },
      group: { include: { studio: true } },
      subscriptionType: true,
    },
  });

  for (const subscription of subscriptionsToRenew) {
    // Ð Ð°ÑÑÑ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð»ÑŒÐ³Ð¾Ñ‚Ñ‹ Ð¸ ÐºÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ð¸
    const basePrice = subscription.subscriptionType.price;
    const discountPercentage = subscription.client.benefitCategory?.discountPercentage || 0;
    const priceAfterDiscount = basePrice * (1 - discountPercentage / 100);
    const finalPrice = Math.max(0, priceAfterDiscount - subscription.compensationAmount);

    // Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÑ‡ÐµÑ‚ Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ
    const renewalInvoice = await prisma.invoice.create({
      data: {
        subscriptionId: subscription.id,
        clientId: subscription.clientId,
        amount: finalPrice,
        dueDate: addDays(subscription.endDate, 1),
        status: 'PENDING',
      },
    });

    // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ ÐºÐ»Ð¸ÐµÐ½Ñ‚Ñƒ
    await sendEmail(subscription.client.email, {
      subject: 'Ð¡Ñ‡ÐµÑ‚ Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°',
      template: 'subscription-renewal',
      data: {
        clientName: `${subscription.client.firstName} ${subscription.client.lastName}`,
        groupName: `${subscription.group.studio.name} â€º ${subscription.group.name}`,
        amount: finalPrice,
        dueDate: format(renewalInvoice.dueDate, 'dd.MM.yyyy'),
        paymentLink: `${BASE_URL}/invoices/${renewalInvoice.id}`,
      },
    });
  }
}
```

---

## Ð—Ð°ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ

ÐœÐ¾Ð´ÑƒÐ»ÑŒ **ÐÐ±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ñ‹ Ð¸ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸** Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ñ†Ð¸ÐºÐ» ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð°Ð¼Ð¸:

- âœ… ÐžÑ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð°Ð±Ð¾Ð½ÐµÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ñ ÑƒÑ‡ÐµÑ‚Ð¾Ð¼ Ð»ÑŒÐ³Ð¾Ñ‚
- âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿Ñ€Ð¾Ð´Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸ Ð¾Ð¿Ð»Ð°Ñ‚Ðµ
- âœ… ÐšÐ¾Ð¼Ð¿ÐµÐ½ÑÐ°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ¾Ð² Ð¿Ð¾ Ð±Ð¾Ð»ÐµÐ·Ð½Ð¸
- âœ… ÐŸÑ€Ð¾Ð¿Ð¾Ñ€Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ð¿Ñ€Ð¸ Ð¾Ñ‚Ð¼ÐµÐ½Ðµ
- âœ… Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ Ð®ÐšÐ°ÑÑÐ° Ð´Ð»Ñ Ð¾Ð½Ð»Ð°Ð¹Ð½-Ð¾Ð¿Ð»Ð°Ñ‚Ñ‹
- âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ
- âœ… ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ñ‚Ñ‡Ð¸ÑÐ»ÐµÐ½Ð¸Ðµ Ð·Ð° Ð½ÐµÑƒÐ¿Ð»Ð°Ñ‚Ñƒ

Ð­Ñ‚Ð¾Ñ‚ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ ÑÐ²Ð»ÑÐµÑ‚ÑÑ ÐºÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ð¼ Ð´Ð»Ñ Ð¼Ð¾Ð½ÐµÑ‚Ð¸Ð·Ð°Ñ†Ð¸Ð¸ ÐºÑƒÐ»ÑŒÑ‚ÑƒÑ€Ð½Ð¾Ð³Ð¾ Ñ†ÐµÐ½Ñ‚Ñ€Ð° Ð¸ Ñ‚ÐµÑÐ½Ð¾ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½ Ñ Ð¼Ð¾Ð´ÑƒÐ»ÑÐ¼Ð¸ CRM, Ð¡Ñ‚ÑƒÐ´Ð¸Ð¹, Ð Ð°ÑÐ¿Ð¸ÑÐ°Ð½Ð¸Ñ Ð¸ ÐžÐ¿Ð»Ð°Ñ‚Ñ‹.

---

**Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¹ Ð¼Ð¾Ð´ÑƒÐ»ÑŒ:** [05_PAYMENTS_MODULE.md](./05_PAYMENTS_MODULE.md) â€” ÐœÐ¾Ð´ÑƒÐ»ÑŒ ÐžÐ¿Ð»Ð°Ñ‚Ñ‹ Ð¸ Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð² (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, ÐµÑÐ»Ð¸ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð±Ð¾Ð»ÐµÐµ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¿Ð»Ð°Ñ‚ÐµÐ¶ÐµÐ¹)
