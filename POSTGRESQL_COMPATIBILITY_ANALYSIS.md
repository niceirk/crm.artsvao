# –ê–Ω–∞–ª–∏–∑ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å PostgreSQL 15-18

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-11-13
**–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –≤ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:** PostgreSQL 15+
**–¶–µ–ª–µ–≤–∞—è –≤–µ—Ä—Å–∏—è:** PostgreSQL 18 (–∏–ª–∏ 17, –µ—Å–ª–∏ 18 –µ—â–µ –Ω–µ –≤—ã–ø—É—â–µ–Ω)

---

## 1. –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

### 1.1. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
‚úÖ –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Prisma ORM, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å PostgreSQL 15-17
‚úÖ –í—Å–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ —Å—Ö–µ–º–∞—Ö, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è PostgreSQL 15+
‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏: PostgreSQL 15+ ‚Üí PostgreSQL 17+

### 1.2. –í–∞–∂–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–µ—Ä—Å–∏—è—Ö
- **PostgreSQL 15** - —Å–µ–Ω—Ç—è–±—Ä—å 2022
- **PostgreSQL 16** - —Å–µ–Ω—Ç—è–±—Ä—å 2023
- **PostgreSQL 17** - —Å–µ–Ω—Ç—è–±—Ä—å 2024
- **PostgreSQL 18** - –æ–∂–∏–¥–∞–µ—Ç—Å—è –æ—Å–µ–Ω—å—é 2025 (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PostgreSQL 17 –∫–∞–∫ —Å—Ç–∞–±–∏–ª—å–Ω—É—é –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é.

---

## 2. –ê–Ω–∞–ª–∏–∑ —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö

### 2.1. –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

| –¢–∏–ø –≤ Prisma | PostgreSQL —Ç–∏–ø | –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|--------------|----------------|---------------|------------|
| `String @db.VarChar(N)` | `VARCHAR(N)` | ‚úÖ –ü–æ–ª–Ω–∞—è | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø |
| `String @db.Text` | `TEXT` | ‚úÖ –ü–æ–ª–Ω–∞—è | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø |
| `DateTime` | `TIMESTAMP` | ‚úÖ –ü–æ–ª–Ω–∞—è | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø |
| `DateTime @db.Date` | `DATE` | ‚úÖ –ü–æ–ª–Ω–∞—è | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø |
| `DateTime @db.Time` | `TIME` | ‚úÖ –ü–æ–ª–Ω–∞—è | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø |
| `Decimal @db.Decimal(10,2)` | `DECIMAL(10,2)` | ‚úÖ –ü–æ–ª–Ω–∞—è | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø |
| `Int` | `INTEGER` | ‚úÖ –ü–æ–ª–Ω–∞—è | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø |
| `Boolean` | `BOOLEAN` | ‚úÖ –ü–æ–ª–Ω–∞—è | –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø |
| `UUID` (—á–µ—Ä–µ–∑ String @id) | `UUID` | ‚úÖ –ü–æ–ª–Ω–∞—è | –¢—Ä–µ–±—É–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è `uuid-ossp` |

### 2.2. –†–∞—Å—à–∏—Ä–µ–Ω–∏—è PostgreSQL

**–¢—Ä–µ–±—É–µ–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:**

```sql
-- –î–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ UUID (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ default(uuid()))
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ (–±—É–¥—É—â–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
CREATE EXTENSION IF NOT EXISTS "pg_trgm";

-- –î–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω–¥–µ–∫—Å–æ–≤
CREATE EXTENSION IF NOT EXISTS "btree_gin";
CREATE EXTENSION IF NOT EXISTS "btree_gist";
```

---

## 3. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è PostgreSQL 17

### 3.1. –ò–Ω–¥–µ–∫—Å—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** –í —Ç–µ–∫—É—â–∏—Ö —Å—Ö–µ–º–∞—Ö –∏–Ω–¥–µ–∫—Å—ã –Ω–µ –æ–ø–∏—Å–∞–Ω—ã —è–≤–Ω–æ.

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**

```prisma
// –í –º–æ–¥–µ–ª–∏ Client
model Client {
  // ... –ø–æ–ª—è

  @@index([phone])  // –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
  @@index([email])  // –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ email
  @@index([lastName, firstName])  // –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –§–ò–û
  @@index([status])  // –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É
  @@index([createdAt])  // –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
}

// –í –º–æ–¥–µ–ª–∏ Payment
model Payment {
  // ... –ø–æ–ª—è

  @@index([clientId])
  @@index([status])
  @@index([paidAt])
  @@index([invoiceId])
}

// –í –º–æ–¥–µ–ª–∏ Schedule
model Schedule {
  // ... –ø–æ–ª—è

  @@index([groupId])
  @@index([roomId])
  @@index([teacherId])
  @@index([dayOfWeek, startTime])  // –ö–æ–º–ø–æ–∑–∏—Ç–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
}

// –í –º–æ–¥–µ–ª–∏ Attendance
model Attendance {
  // ... –ø–æ–ª—è

  @@index([scheduleId])
  @@index([clientId])
  @@index([date])
  @@index([status])
}

// –í –º–æ–¥–µ–ª–∏ Rental
model Rental {
  // ... –ø–æ–ª—è

  @@index([roomId])
  @@index([date, startTime])  // –î–ª—è –ø–æ–∏—Å–∫–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
  @@index([status])
  @@index([clientPhone])  // –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É –∫–ª–∏–µ–Ω—Ç–∞
}

// –í –º–æ–¥–µ–ª–∏ Subscription
model Subscription {
  // ... –ø–æ–ª—è

  @@index([clientId])
  @@index([subscriptionTypeId])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
}

// –í –º–æ–¥–µ–ª–∏ Invoice
model Invoice {
  // ... –ø–æ–ª—è

  @@index([subscriptionId])
  @@index([clientId])
  @@index([status])
  @@index([dueDate])
}
```

### 3.2. –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤.

```prisma
model Client {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è

  searchVector String? @db.Text  // –î–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è tsvector

  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

**SQL –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ search vector:**
```sql
-- –°–æ–∑–¥–∞–µ–º —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è search_vector
CREATE OR REPLACE FUNCTION clients_search_vector_update() RETURNS trigger AS $$
BEGIN
  NEW.search_vector :=
    setweight(to_tsvector('russian', coalesce(NEW.last_name, '')), 'A') ||
    setweight(to_tsvector('russian', coalesce(NEW.first_name, '')), 'B') ||
    setweight(to_tsvector('russian', coalesce(NEW.middle_name, '')), 'B') ||
    setweight(to_tsvector('simple', coalesce(NEW.phone, '')), 'C') ||
    setweight(to_tsvector('simple', coalesce(NEW.email, '')), 'C');
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER clients_search_vector_trigger
BEFORE INSERT OR UPDATE ON clients
FOR EACH ROW EXECUTE FUNCTION clients_search_vector_update();

-- –°–æ–∑–¥–∞–µ–º GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX clients_search_vector_idx ON clients USING GIN(search_vector);
```

### 3.3. –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (–¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã `payments` –∏ `attendances` –ø–æ –¥–∞—Ç–∞–º –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

```sql
-- –ü—Ä–∏–º–µ—Ä –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã payments –ø–æ –≥–æ–¥–∞–º
-- (–¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, Prisma –Ω–∞–ø—Ä—è–º—É—é –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)

CREATE TABLE payments_2024 PARTITION OF payments
    FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');

CREATE TABLE payments_2025 PARTITION OF payments
    FOR VALUES FROM ('2025-01-01') TO ('2026-01-01');
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –±–æ–ª—å—à–æ–º –æ–±—ä–µ–º–µ –¥–∞–Ω–Ω—ã—Ö (>1 –º–ª–Ω –∑–∞–ø–∏—Å–µ–π).

---

## 4. –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ PostgreSQL 16-17

### 4.1. PostgreSQL 16 (—Å–µ–Ω—Ç—è–±—Ä—å 2023)

**–ß—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

1. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏**
   - –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

2. **–£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞ –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–ª—É—á—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

3. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ SQL/JSON –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤**
   ```sql
   SELECT JSON_OBJECT('name': first_name, 'phone': phone) FROM clients;
   ```

4. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å `VACUUM`**
   - –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

### 4.2. PostgreSQL 17 (—Å–µ–Ω—Ç—è–±—Ä—å 2024)

**–ß—Ç–æ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:**

1. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**
   - –ë—ã—Å—Ç—Ä–µ–µ —Ä–∞–±–æ—Ç–∞—é—Ç —Å–ª–æ–∂–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

2. **Incremental Backup**
   - –ë–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å JSON**
   - –ë—ã—Å—Ç—Ä–µ–µ –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON –ø–æ–ª–µ–π (–µ—Å–ª–∏ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è)

4. **NOT NULL constraint –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏ –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã**
   - –ú–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å NOT NULL –Ω–∞ production

---

## 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PostgreSQL –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞

### 5.1. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã postgresql.conf

```ini
# –ü–∞–º—è—Ç—å
shared_buffers = 2GB                    # 25% –æ—Ç RAM
effective_cache_size = 6GB              # 75% –æ—Ç RAM
work_mem = 32MB                         # –î–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–æ–∫ –∏ –¥–∂–æ–∏–Ω–æ–≤
maintenance_work_mem = 512MB            # –î–ª—è VACUUM, CREATE INDEX

# Checkpoint
checkpoint_timeout = 15min
checkpoint_completion_target = 0.9
max_wal_size = 4GB
min_wal_size = 1GB

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
log_min_duration_statement = 1000       # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã > 1 —Å–µ–∫—É–Ω–¥—ã
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
random_page_cost = 1.1                  # –î–ª—è SSD
effective_io_concurrency = 200          # –î–ª—è SSD

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è
max_connections = 100
```

### 5.2. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è Docker

```yaml
# docker-compose.yml
services:
  postgres:
    image: postgres:17-alpine
    environment:
      POSTGRES_DB: cultural_center
      POSTGRES_USER: ccuser
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./init-scripts:/docker-entrypoint-initdb.d  # –î–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π
    command:
      - "postgres"
      - "-c"
      - "shared_buffers=2GB"
      - "-c"
      - "effective_cache_size=6GB"
      - "-c"
      - "work_mem=32MB"
      - "-c"
      - "max_connections=100"

volumes:
  postgres_data:
```

---

## 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### 6.1. PROJECT_SPECIFICATION.md

**–¢–µ–∫—É—â–µ–µ:**
```markdown
### 5.3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**PostgreSQL 15+**
```

**–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞:**
```markdown
### 5.3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**PostgreSQL 17**
- –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è PostgreSQL (—Å–µ–Ω—Ç—è–±—Ä—å 2024)
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
- –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å JSON
- –ù–∞–¥–µ–∂–Ω–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –°–£–ë–î
- –û—Ç–ª–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- JSON/JSONB –ø–æ–ª—è –¥–ª—è –≥–∏–±–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- Full-text search (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pg_trgm)
- –†–µ–ø–ª–∏–∫–∞—Ü–∏—è –∏ –±—ç–∫–∞–ø—ã
- –û—Ç–ª–∏—á–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–¢—Ä–µ–±—É–µ–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è:**
- `uuid-ossp` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è UUID
- `pg_trgm` - –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫
- `btree_gin` –∏ `btree_gist` - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤
```

---

## 7. –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∏–Ω–¥–µ–∫—Å—ã

### 7.1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª init-scripts/001_extensions.sql

```sql
-- –†–∞—Å—à–∏—Ä–µ–Ω–∏—è PostgreSQL –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ Cultural Center
-- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

-- UUID –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
CREATE EXTENSION IF NOT EXISTS "pg_trgm";

-- –£–ª—É—á—à–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
CREATE EXTENSION IF NOT EXISTS "btree_gin";
CREATE EXTENSION IF NOT EXISTS "btree_gist";

-- Unaccent –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
CREATE EXTENSION IF NOT EXISTS "unaccent";
```

### 7.2. –û–±–Ω–æ–≤–∏—Ç—å schema.prisma —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏

–ö–æ–≥–¥–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `schema.prisma`, –¥–æ–±–∞–≤–∏—Ç—å –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 3.1 —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.

---

## 8. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ Prisma

### 8.1. –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

‚úÖ **Prisma 5.x –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å PostgreSQL 17**

```json
// package.json (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –≤–µ—Ä—Å–∏–∏)
{
  "dependencies": {
    "@prisma/client": "^5.20.0"
  },
  "devDependencies": {
    "prisma": "^5.20.0"
  }
}
```

### 8.2. Datasource –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```prisma
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")

  // –î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è connection pooling
  directUrl = env("DIRECT_DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextIndex"]  // –î–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
}
```

---

## 9. –ß–µ–∫-–ª–∏—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- [ ] –û–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏—é PostgreSQL –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏: 15+ ‚Üí 17
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–±—É–µ–º—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ init-scripts
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –≤ schema.prisma (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã postgresql.conf
- [ ] –û–±–Ω–æ–≤–∏—Ç—å docker-compose.yml –Ω–∞ postgres:17-alpine

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é (–¥–ª—è –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏)
- [ ] –í–Ω–µ–¥—Ä–∏—Ç—å connection pooling (PgBouncer)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (pg_stat_statements)

---

## 10. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### 10.1. –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å PostgreSQL 17** –≤–º–µ—Å—Ç–æ 15+ - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —É–ª—É—á—à–µ–Ω–∏–π
2. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è –≤—Å–µ—Ö –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª–µ–π
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è** –¥–ª—è UUID, –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** PostgreSQL –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫—É –ø—Ä–æ–µ–∫—Ç–∞
5. **–í–Ω–µ–¥—Ä–∏—Ç—å –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫** –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤

### 10.2. –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

‚úÖ **–í—Å–µ —Å—Ö–µ–º—ã –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å PostgreSQL 17**
‚úÖ **Prisma ORM –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ PostgreSQL 17**
‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏—è —Å PostgreSQL 15 –Ω–∞ 17 –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Å—Ö–µ–º–µ**

### 10.3. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ PostgreSQL 17:
- üìà **+15-20%** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–ª–æ–∂–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- üìà **+10-15%** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–æ–≤ (—É–ª—É—á—à–µ–Ω–Ω—ã–π B-tree)
- üìà **+30-40%** —Å–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è (incremental backup)
- üìà **+20-25%** –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å JSON –æ–ø–µ—Ä–∞—Ü–∏–π

---

**–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** 2025-11-13
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ã, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω—ã)
